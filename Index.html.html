<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DiveAtlas (Pure HTML)</title>
  <style>

@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Bebas+Neue&display=swap');
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #020817; color: #e2e8f0; }
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: #0a0f1e; }
::-webkit-scrollbar-thumb { background: #1e3a5f; border-radius: 2px; }
.bebas { font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.05em; }
.btn { padding: 8px 18px; border: none; border-radius: 6px; cursor: pointer; font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600; letter-spacing: 0.06em; transition: all 0.15s ease; }
.btn:hover { filter: brightness(1.15); transform: translateY(-1px); }
.btn-ocean { background: linear-gradient(135deg, #0ea5e9, #0284c7); color: #fff; }
.btn-ghost { background: transparent; color: #64748b; border: 1px solid #1e293b; }
.btn-ghost:hover { border-color: #0ea5e9; color: #0ea5e9; filter: none; }
.btn-danger { background: #ef4444; color: #fff; }
.btn-sm { padding: 5px 12px; font-size: 11px; }
.card { background: #0a1628; border: 1px solid #1e293b; border-radius: 10px; padding: 18px; }
.input { background: #0a0f1e; border: 1px solid #1e293b; color: #e2e8f0; padding: 9px 13px; border-radius: 6px; font-family: 'Space Grotesk', sans-serif; font-size: 13px; outline: none; width: 100%; transition: border-color 0.15s; }
.input:focus { border-color: #0ea5e9; box-shadow: 0 0 0 3px rgba(14,165,233,0.1); }
.select { background: #0a0f1e; border: 1px solid #1e293b; color: #94a3b8; padding: 8px 12px; border-radius: 6px; font-family: 'Space Grotesk', sans-serif; font-size: 12px; outline: none; cursor: pointer; }
.select:focus { border-color: #0ea5e9; }
.tag { display: inline-block; padding: 3px 9px; border-radius: 12px; font-size: 10px; font-weight: 600; letter-spacing: 0.07em; text-transform: uppercase; background: #0f172a; border: 1px solid #1e293b; color: #64748b; }
.fade-in { animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
.glow-ocean { box-shadow: 0 0 24px rgba(14,165,233,0.2); }
.pulse { animation: pulse 2s infinite; }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
.nav-tab { padding: 10px 18px; border: none; background: transparent; color: #475569; font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600; letter-spacing: 0.08em; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.15s; }
.nav-tab.active { color: #0ea5e9; border-bottom-color: #0ea5e9; }
.nav-tab:hover { color: #94a3b8; }
.notif { position: fixed; bottom: 24px; right: 24px; z-index: 9999; padding: 13px 22px; border-radius: 8px; font-size: 13px; font-weight: 500; animation: slideUp 0.3s ease; }
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.marker { position: absolute; transform: translate(-50%,-50%); cursor: pointer; transition: all 0.15s; }
.marker:hover { z-index: 100; }
.progress-bar { height: 5px; background: #0f172a; border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, #0ea5e9, #22d3ee); transition: width 0.3s; }

  </style>
  <style>
    /* Minimal layout helpers (pure HTML version) */
    .app { font-family: 'Space Grotesk', sans-serif; background:#020817; color:#e2e8f0; min-height:100vh; display:flex; flex-direction:column; }
    header { position:sticky; top:0; z-index:5; background:#020817; border-bottom:1px solid #0f172a; }
    .header-inner { height:52px; display:flex; align-items:center; gap:10px; padding:0 14px; }
    .brand { font-family:'Bebas Neue', system-ui, sans-serif; letter-spacing:1px; font-size:22px; }
    .spacer { flex:1; }
    .navbtn { padding:8px 10px; border:1px solid #0f172a; background:#0b1220; color:#e2e8f0; border-radius:10px; cursor:pointer; font-weight:600; }
    .navbtn.active { border-color:#0ea5e9; box-shadow:0 0 0 1px rgba(14,165,233,.25) inset; }
    .pill { font-size:12px; padding:2px 8px; border-radius:999px; border:1px solid #0f172a; background:#0b1220; color:#a5b4fc; }
    main { flex:1; overflow:auto; }
    .wrap { max-width:1100px; margin:0 auto; padding:14px; }
    .row { display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
    .ctrl { background:#0b1220; border:1px solid #0f172a; border-radius:12px; padding:10px; }
    .ctrl label { font-size:12px; color:#94a3b8; display:block; margin-bottom:6px; }
    .ctrl select, .ctrl input { width:220px; max-width:100%; background:#020817; color:#e2e8f0; border:1px solid #0f172a; border-radius:10px; padding:10px; outline:none; }
    .ctrl input::placeholder { color:#64748b; }
    .btn { padding:10px 12px; border:1px solid #0f172a; background:#0b1220; color:#e2e8f0; border-radius:12px; cursor:pointer; font-weight:700; }
    .btn.primary { border-color:#0ea5e9; }
    .btn.danger { border-color:#f97316; }
    .grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap:12px; margin-top:12px; }
    .card { background:#0b1220; border:1px solid #0f172a; border-radius:16px; padding:12px; box-shadow: 0 6px 20px rgba(0,0,0,.25); }
    .card h3 { font-size:18px; margin-bottom:6px; }
    .muted { color:#94a3b8; }
    .meta { display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
    .tag { font-size:12px; padding:3px 8px; border-radius:999px; background:#020817; border:1px solid #0f172a; color:#93c5fd; }
    .tag.alt { color:#a7f3d0; }
    .tag.warn { color:#fdba74; }
    .tag.gray { color:#cbd5e1; }
    .card .actions { display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .split { display:grid; grid-template-columns: 1.1fr 0.9fr; gap:12px; }
    @media (max-width: 860px) { .split { grid-template-columns: 1fr; } }
    .toast { position:fixed; right:14px; bottom:14px; padding:12px 14px; border-radius:14px; background:#0b1220; border:1px solid #0f172a; box-shadow: 0 8px 30px rgba(0,0,0,.35); }
    .toast.ok { border-color:#22c55e; }
    .toast.err { border-color:#fb7185; }
    table { width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:16px; border:1px solid #0f172a; background:#0b1220; }
    th, td { padding:10px; border-bottom:1px solid #0f172a; vertical-align:top; }
    th { text-align:left; color:#94a3b8; font-weight:700; background:#070f1d; }
    tr:last-child td { border-bottom:none; }
    a.link { color:#60a5fa; text-decoration:none; }
    a.link:hover { text-decoration:underline; }
    .small { font-size:12px; }
    .kpi { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
    .kpi .box { background:#020817; border:1px solid #0f172a; border-radius:14px; padding:10px 12px; min-width:160px; }
    .kpi .num { font-size:18px; font-weight:800; }
    .kpi .lbl { font-size:12px; color:#94a3b8; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="header-inner">
        <div class="brand">DiveAtlas</div>
        <span class="pill" id="countPill"></span>
        <div class="spacer"></div>
        <button class="navbtn" id="navMap">Map</button>
        <button class="navbtn" id="navList">List</button>
        <button class="navbtn" id="navCompare">Compare <span class="small" id="compareCount"></span></button>
        <button class="navbtn" id="navProfile">Profile</button>
      </div>
    </header>

    <main>
      <div class="wrap" id="appRoot"></div>
    </main>

    <div id="toastRoot"></div>
  </div>

  <script>
const SITES = [
  {id:1,name:"Great Blue Hole",country:"Belize",region:"Caribbean",lat:17.316,lng:-87.535,diff:"advanced",cert:"AOW",types:["cave","reef"],maxD:40,avgD:20,vis:30,temp:27,current:"light",wildlife:["sharks","grouper","reef fish","stalactites"],budget:"medium",crowd:"high",rating:4.8,dives:3420,months:[11,12,1,2,3,4,5],photo:"wide-angle",desc:"World-famous 300m-wide marine sinkhole. Stalactite formations at depth, Caribbean reef sharks patrol the rim. A bucket-list icon.",entry:"boat",town:"San Pedro, Belize",wreck:false},
  {id:2,name:"Palancar Reef",country:"Mexico",region:"Caribbean",lat:20.348,lng:-87.074,diff:"intermediate",cert:"OW",types:["reef","wall"],maxD:30,avgD:15,vis:35,temp:28,current:"moderate",wildlife:["turtles","eagle rays","moray eels","reef fish"],budget:"medium",crowd:"high",rating:4.7,dives:5200,months:[3,4,5,6,7,8,9,10],photo:"wide-angle",desc:"Cozumel's crown jewel. Towering coral buttresses and swim-throughs teeming with sea turtles and eagle rays.",entry:"boat",town:"San Miguel, Cozumel",wreck:false},
  {id:3,name:"USS Kittiwake",country:"Cayman Islands",region:"Caribbean",lat:19.355,lng:-81.38,diff:"intermediate",cert:"OW",types:["wreck"],maxD:19,avgD:12,vis:25,temp:27,current:"none",wildlife:["turtles","nurse sharks","reef fish"],budget:"medium",crowd:"medium",rating:4.5,dives:2800,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"180-foot submarine rescue vessel deliberately sunk in 2011. Excellent penetration diving through multiple decks.",entry:"shore",town:"Seven Mile Beach, Grand Cayman",wreck:true},
  {id:4,name:"Bloody Bay Wall",country:"Cayman Islands",region:"Caribbean",lat:19.741,lng:-80.09,diff:"intermediate",cert:"OW",types:["wall"],maxD:500,avgD:18,vis:40,temp:27,current:"light",wildlife:["eagle rays","turtles","dolphins","reef fish"],budget:"medium",crowd:"low",rating:4.9,dives:1200,months:[1,2,3,4,5,11,12],photo:"wide-angle",desc:"Little Cayman's legendary wall drops from 6m to 500m. Pristine coral, exceptional visibility, minimal crowds.",entry:"boat",town:"Little Cayman",wreck:false},
  {id:5,name:"Jardines de la Reina",country:"Cuba",region:"Caribbean",lat:20.832,lng:-78.954,diff:"intermediate",cert:"AOW",types:["reef","drift"],maxD:30,avgD:15,vis:30,temp:28,current:"moderate",wildlife:["sharks","grouper","turtles","crocodiles"],budget:"high",crowd:"low",rating:4.9,dives:800,months:[12,1,2,3,4,5],photo:"wide-angle",desc:"Cuba's protected 'Garden of the Queen'. Exceptional shark diversity: silky, reef, and nurse sharks in pristine waters.",entry:"liveaboard",town:"Cienfuegos",wreck:false},
  {id:6,name:"SS Thistlegorm",country:"Egypt",region:"Red Sea",lat:27.812,lng:33.92,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:32,avgD:18,vis:20,temp:24,current:"moderate",wildlife:["reef fish","barracuda","batfish","moray eels"],budget:"low",crowd:"high",rating:4.9,dives:15000,months:[9,10,11,12,1,2,3,4,5],photo:"wide-angle",desc:"World's most famous WWII wreck. British merchant ship packed with motorcycles, trucks, and military equipment.",entry:"boat",town:"Sharm el-Sheikh",wreck:true},
  {id:7,name:"Ras Mohammed",country:"Egypt",region:"Red Sea",lat:27.736,lng:34.242,diff:"intermediate",cert:"OW",types:["reef","wall","drift"],maxD:40,avgD:20,vis:30,temp:24,current:"moderate",wildlife:["reef fish","sharks","barracuda","jacks"],budget:"low",crowd:"medium",rating:4.8,dives:8900,months:[9,10,11,12,1,2,3,4,5,6],photo:"wide-angle",desc:"Egypt's premier marine park. Dramatic walls festooned with sea fans. Famous jackfish tornado in the blue water.",entry:"boat",town:"Sharm el-Sheikh",wreck:false},
  {id:8,name:"Blue Hole Dahab",country:"Egypt",region:"Red Sea",lat:28.573,lng:34.539,diff:"technical",cert:"Tech",types:["cave","wall"],maxD:100,avgD:30,vis:30,temp:22,current:"none",wildlife:["reef fish","turtles","napoleon wrasse"],budget:"low",crowd:"medium",rating:4.7,dives:6200,months:[9,10,11,12,1,2,3,4,5,6],photo:"wide-angle",desc:"Sinai's legendary submarine sinkhole. The arch at 56m leads to the wall. A rite of passage for serious divers.",entry:"shore",town:"Dahab",wreck:false},
  {id:9,name:"Brother Islands",country:"Egypt",region:"Red Sea",lat:26.323,lng:34.847,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:20,vis:30,temp:25,current:"strong",wildlife:["sharks","manta rays","thresher sharks","hammerheads"],budget:"high",crowd:"low",rating:4.9,dives:2100,months:[4,5,6,7,8,9,10],photo:"wide-angle",desc:"Remote twin islands ‚Äî Egypt's best shark action. Oceanic whitetip, hammerhead, silvertip and grey reef sharks.",entry:"liveaboard",town:"Hurghada",wreck:false},
  {id:10,name:"Elphinstone Reef",country:"Egypt",region:"Red Sea",lat:24.887,lng:35.034,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:22,vis:30,temp:25,current:"strong",wildlife:["sharks","dolphins","reef fish"],budget:"medium",crowd:"medium",rating:4.8,dives:3400,months:[9,10,11,12,1,2,3,4],photo:"wide-angle",desc:"Spectacular elongated reef with dramatic overhangs. Oceanic whitetip sharks circle the plateau.",entry:"boat",town:"Marsa Alam",wreck:false},
  {id:11,name:"Komodo National Park",country:"Indonesia",region:"Indo-Pacific",lat:-8.557,lng:119.49,diff:"advanced",cert:"AOW",types:["reef","drift"],maxD:40,avgD:18,vis:20,temp:26,current:"strong",wildlife:["manta rays","sharks","dolphins","reef fish"],budget:"medium",crowd:"medium",rating:4.9,dives:6800,months:[4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"Dramatic drift dives through volcanic island channels. Manta rays at cleaning stations, incredible coral diversity.",entry:"liveaboard",town:"Labuan Bajo",wreck:false},
  {id:12,name:"Tulamben USAT Liberty",country:"Indonesia",region:"Indo-Pacific",lat:-8.273,lng:115.59,diff:"beginner",cert:"OW",types:["wreck","macro"],maxD:29,avgD:10,vis:20,temp:27,current:"none",wildlife:["nudibranchs","frogfish","bumphead parrotfish","reef fish"],budget:"low",crowd:"medium",rating:4.7,dives:9200,months:[4,5,6,7,8,9,10,11],photo:"macro",desc:"WWII cargo ship sunk by Japanese torpedo, now draped in stunning coral. Shore dive with incredible critter diversity.",entry:"shore",town:"Tulamben, Bali",wreck:true},
  {id:13,name:"Manta Point Nusa Penida",country:"Indonesia",region:"Indo-Pacific",lat:-8.76,lng:115.46,diff:"intermediate",cert:"OW",types:["reef"],maxD:20,avgD:10,vis:15,temp:26,current:"moderate",wildlife:["manta rays","reef fish","turtles"],budget:"low",crowd:"high",rating:4.8,dives:7800,months:[7,8,9,10,11],photo:"wide-angle",desc:"Bali's famous manta cleaning station. Up to 15 giant mantas circling overhead as cleaner wrasse tend to them.",entry:"boat",town:"Nusa Penida, Bali",wreck:false},
  {id:14,name:"Raja Ampat: Misool",country:"Indonesia",region:"Indo-Pacific",lat:-2.083,lng:130.167,diff:"intermediate",cert:"OW",types:["reef","macro"],maxD:40,avgD:15,vis:25,temp:28,current:"moderate",wildlife:["reef fish","sharks","nudibranchs","wobbegongs"],budget:"high",crowd:"low",rating:4.9,dives:1800,months:[10,11,12,1,2,3,4,5,6],photo:"both",desc:"Heart of the Coral Triangle. Staggering biodiversity, remote island setting, extraordinary soft corals and sea fans.",entry:"liveaboard",town:"Sorong",wreck:false},
  {id:15,name:"Lembeh Strait",country:"Indonesia",region:"Indo-Pacific",lat:1.466,lng:125.242,diff:"intermediate",cert:"OW",types:["muck","macro"],maxD:25,avgD:10,vis:10,temp:27,current:"light",wildlife:["frogfish","nudibranchs","seahorses","mimic octopus","mantis shrimp"],budget:"medium",crowd:"medium",rating:4.9,dives:5400,months:[1,2,3,4,5,10,11,12],photo:"macro",desc:"World capital of muck diving. Mimic octopus, hairy frogfish, blue-ringed octopus ‚Äî more weird life per dive than anywhere.",entry:"shore",town:"Bitung, North Sulawesi",wreck:false},
  {id:16,name:"Blue Corner",country:"Palau",region:"Pacific Islands",lat:7.108,lng:134.218,diff:"advanced",cert:"AOW",types:["reef","drift"],maxD:40,avgD:20,vis:30,temp:28,current:"strong",wildlife:["sharks","barracuda","napoleon wrasse","reef fish"],budget:"high",crowd:"medium",rating:4.9,dives:4200,months:[10,11,12,1,2,3,4,5],photo:"wide-angle",desc:"Palau's most famous dive. Reef hook in and watch the parade of grey reef sharks, whitetips, and massive fish schools.",entry:"boat",town:"Koror",wreck:false},
  {id:17,name:"Truk Lagoon",country:"Micronesia",region:"Pacific Islands",lat:7.35,lng:151.85,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:40,avgD:20,vis:25,temp:28,current:"light",wildlife:["reef fish","sharks","turtles","anemonefish"],budget:"high",crowd:"low",rating:4.9,dives:2800,months:[12,1,2,3,4,5,6,7],photo:"wide-angle",desc:"World's greatest wreck diving. 60+ Japanese WWII ships sunk in Operation Hailstone. Ghostly cargo holds.",entry:"liveaboard",town:"Weno, Chuuk",wreck:true},
  {id:18,name:"Richelieu Rock",country:"Thailand",region:"Indo-Pacific",lat:9.445,lng:97.827,diff:"intermediate",cert:"AOW",types:["reef","macro"],maxD:35,avgD:15,vis:20,temp:28,current:"moderate",wildlife:["whale sharks","manta rays","nudibranchs","seahorses"],budget:"medium",crowd:"medium",rating:4.9,dives:5600,months:[11,12,1,2,3,4,5],photo:"both",desc:"Thailand's greatest dive site. Submerged pinnacle teeming with life. Whale sharks Jan-May. Remarkable biodiversity.",entry:"liveaboard",town:"Khao Lak",wreck:false},
  {id:19,name:"Sipadan",country:"Malaysia",region:"Indo-Pacific",lat:4.115,lng:118.628,diff:"intermediate",cert:"OW",types:["wall","reef"],maxD:40,avgD:18,vis:30,temp:28,current:"moderate",wildlife:["turtles","sharks","barracuda tornado","reef fish"],budget:"high",crowd:"medium",rating:4.9,dives:4800,months:[4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"Malaysia's only oceanic island. Turtle Cavern, Barracuda Point with spiraling tornado, prolific shark action.",entry:"boat",town:"Semporna, Sabah",wreck:false},
  {id:20,name:"Great Barrier Reef: Osprey",country:"Australia",region:"Pacific Islands",lat:-13.883,lng:146.533,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:20,vis:40,temp:24,current:"strong",wildlife:["sharks","manta rays","dolphins","reef fish"],budget:"high",crowd:"low",rating:4.9,dives:1400,months:[9,10,11,12,1,2,3],photo:"wide-angle",desc:"Remote Coral Sea atoll. North Horn shark feeding, pristine walls to 1000m depth, exceptional visibility.",entry:"liveaboard",town:"Cairns",wreck:false},
  {id:21,name:"Gozo Blue Hole",country:"Malta",region:"Mediterranean",lat:36.051,lng:14.19,diff:"intermediate",cert:"AOW",types:["cave","wall"],maxD:40,avgD:18,vis:30,temp:19,current:"light",wildlife:["grouper","octopus","bream","reef fish"],budget:"low",crowd:"medium",rating:4.7,dives:4800,months:[5,6,7,8,9,10,11],photo:"wide-angle",desc:"Malta's iconic blue hole and natural chimney leading to spectacular wall. Cathedral-like light effects.",entry:"shore",town:"Dwejra, Gozo",wreck:false},
  {id:22,name:"Zenobia",country:"Cyprus",region:"Mediterranean",lat:34.942,lng:33.917,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:42,avgD:22,vis:25,temp:20,current:"light",wildlife:["barracuda","grouper","turtles","reef fish"],budget:"low",crowd:"medium",rating:4.8,dives:6200,months:[5,6,7,8,9,10,11],photo:"wide-angle",desc:"Europe's best wreck dive. Swedish ferry sunk 1980, laden with trucks, lying on its side at 43m.",entry:"boat",town:"Larnaca",wreck:true},
  {id:23,name:"Coron Wrecks",country:"Philippines",region:"Indo-Pacific",lat:11.983,lng:120.2,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:38,avgD:20,vis:15,temp:27,current:"light",wildlife:["reef fish","turtles","barracuda"],budget:"low",crowd:"medium",rating:4.8,dives:4200,months:[11,12,1,2,3,4,5,6],photo:"wide-angle",desc:"12 Japanese WWII warships in a breathtaking island setting. Heavily coral-encrusted with excellent penetration.",entry:"boat",town:"Coron Town, Palawan",wreck:true},
  {id:24,name:"Tubbataha Reef",country:"Philippines",region:"Indo-Pacific",lat:8.85,lng:119.917,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:20,vis:40,temp:28,current:"strong",wildlife:["sharks","manta rays","dolphins","reef fish"],budget:"high",crowd:"low",rating:4.9,dives:1600,months:[3,4,5,6],photo:"wide-angle",desc:"UNESCO World Heritage site in the Sulu Sea. Liveaboard only. Pristine walls, huge shark diversity.",entry:"liveaboard",town:"Puerto Princesa, Palawan",wreck:false},
  {id:25,name:"Thresher Shark Malapascua",country:"Philippines",region:"Indo-Pacific",lat:10.133,lng:124.217,diff:"advanced",cert:"AOW",types:["reef"],maxD:35,avgD:25,vis:30,temp:27,current:"moderate",wildlife:["thresher sharks","reef fish","hammerheads"],budget:"low",crowd:"medium",rating:4.8,dives:3200,months:[3,4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"Malapascua's famous thresher shark cleaning station. Dawn dives at Monad Shoal deliver thresher sightings.",entry:"boat",town:"Malapascua Island, Cebu",wreck:false},
  {id:26,name:"Anilao",country:"Philippines",region:"Indo-Pacific",lat:13.667,lng:120.9,diff:"beginner",cert:"OW",types:["macro","muck"],maxD:25,avgD:10,vis:15,temp:27,current:"light",wildlife:["nudibranchs","frogfish","seahorses","bobtail squid","mantis shrimp"],budget:"low",crowd:"medium",rating:4.7,dives:5600,months:[11,12,1,2,3,4,5],photo:"macro",desc:"Philippines' macro capital. Hundreds of nudibranch species, hairy frogfish ‚Äî a macro photographer's dream.",entry:"shore",town:"Batangas",wreck:false},
  {id:27,name:"Manta Point Baa Atoll",country:"Maldives",region:"Indo-Pacific",lat:5.1,lng:73.017,diff:"beginner",cert:"OW",types:["reef"],maxD:15,avgD:8,vis:20,temp:28,current:"moderate",wildlife:["manta rays","reef fish","whale sharks"],budget:"high",crowd:"medium",rating:4.9,dives:3800,months:[5,6,7,8,9,10],photo:"wide-angle",desc:"World's largest manta ray aggregation during Southwest Monsoon. Up to 200 mantas feeding in Hanifaru Bay.",entry:"boat",town:"Eydhafushi, Baa Atoll",wreck:false},
  {id:28,name:"Hammerhead Point Rasdhoo",country:"Maldives",region:"Indo-Pacific",lat:4.267,lng:72.967,diff:"advanced",cert:"AOW",types:["reef","drift"],maxD:40,avgD:20,vis:30,temp:28,current:"strong",wildlife:["hammerhead sharks","manta rays","reef fish"],budget:"high",crowd:"low",rating:4.8,dives:1200,months:[12,1,2,3,4,5],photo:"wide-angle",desc:"Rasdhoo Atoll's famous hammerhead school. Early morning dives reward with schools of scalloped hammerheads.",entry:"boat",town:"Rasdhoo",wreck:false},
  {id:29,name:"Cenote Dos Ojos",country:"Mexico",region:"Caribbean",lat:20.338,lng:-87.402,diff:"intermediate",cert:"AOW",types:["cenote","cave"],maxD:20,avgD:10,vis:60,temp:24,current:"none",wildlife:["cave fish","stalactites","halocline"],budget:"low",crowd:"high",rating:4.8,dives:8900,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"Riviera Maya's most famous cenote. 'Two Eyes' twin caverns with otherworldly 60m visibility through limestone passages.",entry:"shore",town:"Tulum",wreck:false},
  {id:30,name:"Cenote Angelita",country:"Mexico",region:"Caribbean",lat:20.192,lng:-87.478,diff:"advanced",cert:"Tech",types:["cenote","cave"],maxD:60,avgD:30,vis:40,temp:24,current:"none",wildlife:["cave fish","hydrogen sulfide cloud"],budget:"medium",crowd:"low",rating:4.9,dives:1200,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"Extraordinary hydrogen sulfide cloud at 30m creates a ghostly 'river' separating fresh and salt water layers.",entry:"shore",town:"Tulum",wreck:false},
  {id:31,name:"Silfra Fissure",country:"Iceland",region:"Atlantic",lat:64.259,lng:-21.121,diff:"intermediate",cert:"OW",types:["cave","drift"],maxD:18,avgD:10,vis:100,temp:3,current:"light",wildlife:["arctic algae","arctic fish","amphipods"],budget:"medium",crowd:"medium",rating:4.7,dives:3200,months:[5,6,7,8,9],photo:"wide-angle",desc:"Dive between tectonic plates of America and Europe. Glacial meltwater gives 100m visibility. Ethereal landscapes.",entry:"shore",town:"Reykjavik",wreck:false},
  {id:32,name:"Scapa Flow",country:"UK",region:"Atlantic",lat:58.9,lng:-3.1,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:45,avgD:25,vis:15,temp:8,current:"moderate",wildlife:["reef fish","nudibranchs","crabs","anemones"],budget:"medium",crowd:"low",rating:4.8,dives:3400,months:[5,6,7,8,9],photo:"wide-angle",desc:"Orkney's famous German WWI fleet scuttling. Seven battleships and cruisers. Historic cold-water wreck diving.",entry:"boat",town:"Stromness, Orkney",wreck:true},
  {id:33,name:"Azores: Princess Alice",country:"Portugal",region:"Atlantic",lat:37.2,lng:-24.25,diff:"advanced",cert:"AOW",types:["reef","drift"],maxD:40,avgD:20,vis:30,temp:20,current:"strong",wildlife:["manta rays","mobula rays","blue sharks","dolphins","whales"],budget:"high",crowd:"low",rating:4.9,dives:680,months:[5,6,7,8,9,10],photo:"wide-angle",desc:"Remote Mid-Atlantic seamount. Mobula rays by the thousands, manta rays, blue sharks. Extraordinary pelagic action.",entry:"liveaboard",town:"Horta, Faial",wreck:false},
  {id:34,name:"Galapagos Wolf Island",country:"Ecuador",region:"Pacific Islands",lat:1.4,lng:-91.817,diff:"advanced",cert:"AOW",types:["reef","drift","wall"],maxD:40,avgD:20,vis:15,temp:20,current:"strong",wildlife:["hammerhead sharks","whale sharks","Galapagos sharks","manta rays","marine iguanas"],budget:"high",crowd:"low",rating:4.9,dives:1200,months:[6,7,8,9,10,11,12,1,2],photo:"wide-angle",desc:"Holy grail of diving. Schooling hammerheads, whale sharks, marine iguanas ‚Äî dramatic volcanic wall diving.",entry:"liveaboard",town:"Puerto Baquerizo Moreno",wreck:false},
  {id:35,name:"Cocos Island",country:"Costa Rica",region:"Pacific Islands",lat:5.533,lng:-87.067,diff:"advanced",cert:"AOW",types:["reef","drift","wall"],maxD:40,avgD:22,vis:20,temp:27,current:"strong",wildlife:["hammerhead sharks","manta rays","dolphins","whales"],budget:"high",crowd:"low",rating:4.9,dives:920,months:[5,6,7,8,9,10,11,12,1,2],photo:"wide-angle",desc:"UNESCO Heritage Site. Thousands of scalloped hammerheads at Manuelita. One of the world's top 3 dives.",entry:"liveaboard",town:"Puntarenas",wreck:false},
  {id:36,name:"SS President Coolidge",country:"Vanuatu",region:"Pacific Islands",lat:-15.508,lng:167.187,diff:"advanced",cert:"AOW",types:["wreck"],maxD:65,avgD:25,vis:25,temp:26,current:"light",wildlife:["reef fish","turtles","barracuda","lion fish"],budget:"medium",crowd:"low",rating:4.8,dives:2200,months:[4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"WWII luxury liner sunk by own mines. Massive wreck with cargo hold artifacts and luxury fittings intact.",entry:"shore",town:"Luganville, Espiritu Santo",wreck:true},
  {id:37,name:"Sodwana Bay",country:"South Africa",region:"Indo-Pacific",lat:-27.533,lng:32.683,diff:"intermediate",cert:"AOW",types:["reef","macro"],maxD:30,avgD:18,vis:15,temp:22,current:"moderate",wildlife:["sharks","rays","turtles","reef fish","raggedtooth sharks"],budget:"low",crowd:"medium",rating:4.5,dives:3200,months:[11,12,1,2,3,4],photo:"both",desc:"Southernmost coral reef in Africa. Ragged-tooth shark nursery, exceptional macro life, rare endemic species.",entry:"boat",town:"Mkuze",wreck:false},
  {id:38,name:"Great White Cage Gansbaai",country:"South Africa",region:"Indo-Pacific",lat:-34.817,lng:19.633,diff:"beginner",cert:"OW",types:["reef"],maxD:5,avgD:3,vis:10,temp:14,current:"moderate",wildlife:["great white sharks"],budget:"medium",crowd:"high",rating:4.7,dives:8900,months:[6,7,8,9,10,11],photo:"wide-angle",desc:"Cage dive with the ocean's apex predator. Great white sharks up to 5m circling the cage at Shark Alley.",entry:"boat",town:"Gansbaai, Western Cape",wreck:false},
  {id:39,name:"Mozambique: Tofo",country:"Mozambique",region:"Indo-Pacific",lat:-23.867,lng:35.533,diff:"intermediate",cert:"OW",types:["reef","drift"],maxD:30,avgD:15,vis:15,temp:25,current:"moderate",wildlife:["whale sharks","manta rays","dolphins","reef fish"],budget:"low",crowd:"low",rating:4.7,dives:2200,months:[10,11,12,1,2,3,4,5,6],photo:"wide-angle",desc:"Africa's marine megafauna capital. Year-round whale sharks, resident manta rays, humpback whales Jul-Nov.",entry:"boat",town:"Tofo",wreck:false},
  {id:40,name:"Fernando de Noronha",country:"Brazil",region:"Atlantic",lat:-3.858,lng:-32.426,diff:"intermediate",cert:"OW",types:["reef","drift","wall"],maxD:40,avgD:18,vis:40,temp:27,current:"strong",wildlife:["spinner dolphins","spinner sharks","turtles","reef fish"],budget:"high",crowd:"low",rating:4.9,dives:1200,months:[9,10,11,12,1,2,3,4],photo:"wide-angle",desc:"Brazil's UNESCO paradise island. Spinner dolphin bay, extraordinary 40m visibility, vibrant marine life.",entry:"boat",town:"Vila dos Rem√©dios",wreck:false},
  {id:41,name:"Bonaire: Salt Pier",country:"Bonaire",region:"Caribbean",lat:12.104,lng:-68.284,diff:"beginner",cert:"OW",types:["reef","macro"],maxD:20,avgD:10,vis:25,temp:27,current:"none",wildlife:["seahorses","frogfish","moray eels","nudibranchs"],budget:"low",crowd:"medium",rating:4.6,dives:4800,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"macro",desc:"Bonaire's most photogenic pier. Massive encrusted pylons full of macro life, seahorses, and frogfish up close.",entry:"shore",town:"Kralendijk",wreck:false},
  {id:42,name:"Yap Manta Bay",country:"Micronesia",region:"Pacific Islands",lat:9.533,lng:138.133,diff:"intermediate",cert:"OW",types:["reef"],maxD:20,avgD:10,vis:20,temp:28,current:"moderate",wildlife:["manta rays","reef fish","turtles"],budget:"high",crowd:"low",rating:4.8,dives:1400,months:[12,1,2,3,4,5,6,7],photo:"wide-angle",desc:"Yap's famous manta channel. Resident manta rays visit cleaning stations year-round. Culturally rich destination.",entry:"boat",town:"Colonia, Yap",wreck:false},
  {id:43,name:"Bikini Atoll",country:"Marshall Islands",region:"Pacific Islands",lat:11.5,lng:165.383,diff:"advanced",cert:"AOW",types:["wreck"],maxD:55,avgD:30,vis:30,temp:28,current:"moderate",wildlife:["sharks","reef fish","large pelagics"],budget:"high",crowd:"low",rating:4.9,dives:180,months:[3,4,5,6,7,8],photo:"wide-angle",desc:"UNESCO World Heritage Site. Nuclear test site with massive fleet including USS Saratoga and Nagato battleship.",entry:"liveaboard",town:"Majuro",wreck:true},
  {id:44,name:"Rangiroa: Tiputa Pass",country:"French Polynesia",region:"Pacific Islands",lat:-14.967,lng:-147.65,diff:"advanced",cert:"AOW",types:["drift","reef"],maxD:40,avgD:20,vis:40,temp:27,current:"strong",wildlife:["dolphins","hammerhead sharks","manta rays","reef fish"],budget:"medium",crowd:"low",rating:4.8,dives:1800,months:[6,7,8,9,10,11,12,1],photo:"wide-angle",desc:"One of the world's great drift dives. Hundreds of dolphins, hammerheads, and mantas in crystal atoll passes.",entry:"boat",town:"Avatoru, Rangiroa",wreck:false},
  {id:45,name:"Fakarava South Pass",country:"French Polynesia",region:"Pacific Islands",lat:-16.617,lng:-145.45,diff:"advanced",cert:"AOW",types:["drift","reef"],maxD:40,avgD:20,vis:40,temp:27,current:"strong",wildlife:["grey reef sharks","reef fish","dolphins"],budget:"medium",crowd:"low",rating:4.9,dives:1200,months:[6,7,8,9,10],photo:"wide-angle",desc:"UNESCO Biosphere Reserve. 600+ grey reef sharks hunting the pass during spawning season. Epic spectacle.",entry:"boat",town:"Rotoava, Fakarava",wreck:false},
  {id:46,name:"Kona Manta Night Dive",country:"USA",region:"Pacific Islands",lat:19.567,lng:-155.983,diff:"beginner",cert:"OW",types:["reef"],maxD:12,avgD:8,vis:15,temp:25,current:"none",wildlife:["manta rays","reef fish","plankton"],budget:"medium",crowd:"high",rating:4.9,dives:15000,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"World's most famous manta ray night dive. Divers' torches attract plankton, bringing 10-20 mantas doing barrel rolls.",entry:"boat",town:"Kailua-Kona, Big Island",wreck:false},
  {id:47,name:"Socorro: Roca Partida",country:"Mexico",region:"Pacific Islands",lat:19.0,lng:-112.067,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:25,vis:30,temp:22,current:"strong",wildlife:["manta rays","whale sharks","silky sharks","dolphins","tuna"],budget:"high",crowd:"low",rating:4.9,dives:580,months:[11,12,1,2,3,4,5],photo:"wide-angle",desc:"Revillagigedo's remote pinnacle. 360¬∞ diving on a tiny volcanic rock with whitetips, mantas, and silky sharks.",entry:"liveaboard",town:"Cabo San Lucas",wreck:false},
  {id:48,name:"Poor Knights Islands",country:"New Zealand",region:"Pacific Islands",lat:-35.467,lng:174.733,diff:"intermediate",cert:"OW",types:["cave","wall","reef"],maxD:40,avgD:18,vis:25,temp:18,current:"moderate",wildlife:["fish","rays","dolphins","moray eels"],budget:"medium",crowd:"low",rating:4.7,dives:2400,months:[12,1,2,3,4,5],photo:"wide-angle",desc:"Jacques Cousteau's Top 10 dive location. Dramatic volcanic arches and caverns, richest subtropical NZ marine life.",entry:"boat",town:"Tutukaka, Northland",wreck:false},
  {id:49,name:"Tonga Humpback Whales",country:"Tonga",region:"Pacific Islands",lat:-19.75,lng:-174.35,diff:"beginner",cert:"OW",types:["reef"],maxD:20,avgD:10,vis:30,temp:24,current:"light",wildlife:["humpback whales","reef fish","turtles"],budget:"high",crowd:"low",rating:4.9,dives:680,months:[7,8,9,10],photo:"wide-angle",desc:"In-water humpback whale encounters. Mothers, calves, and singers in Ha'apai's shallow warm waters. Magical.",entry:"liveaboard",town:"Pangai",wreck:false},
  {id:50,name:"Fiji: Great White Wall",country:"Fiji",region:"Pacific Islands",lat:-16.817,lng:-179.933,diff:"advanced",cert:"AOW",types:["wall","drift"],maxD:40,avgD:25,vis:30,temp:26,current:"strong",wildlife:["reef fish","sharks","dolphins","sea fans"],budget:"high",crowd:"low",rating:4.8,dives:2200,months:[7,8,9,10,11,12,1,2,3,4],photo:"wide-angle",desc:"Taveuni's legendary dive. Vertical wall carpeted entirely in white soft coral. Spectacular color contrast.",entry:"boat",town:"Matagi Island, Taveuni",wreck:false},
  {id:51,name:"Portofino Marine Reserve",country:"Italy",region:"Mediterranean",lat:44.298,lng:9.217,diff:"beginner",cert:"OW",types:["reef","macro"],maxD:25,avgD:12,vis:15,temp:18,current:"none",wildlife:["gorgonian fans","grouper","octopus","moray eels"],budget:"medium",crowd:"medium",rating:4.4,dives:2800,months:[5,6,7,8,9,10],photo:"both",desc:"Ligurian marine reserve with stunning red gorgonian forests. Giant grouper roam the cathedral rocks.",entry:"boat",town:"Portofino",wreck:false},
  {id:52,name:"Sardinia: Nereo Cave",country:"Italy",region:"Mediterranean",lat:40.65,lng:8.1,diff:"intermediate",cert:"AOW",types:["cave","reef"],maxD:35,avgD:15,vis:30,temp:19,current:"light",wildlife:["grouper","bream","lobsters","reef fish"],budget:"low",crowd:"low",rating:4.5,dives:2200,months:[5,6,7,8,9,10,11],photo:"wide-angle",desc:"Mediterranean's largest accessible sea cave. Cavernous chambers with bioluminescence and enormous grouper.",entry:"boat",town:"Capo Caccia, Alghero",wreck:false},
  {id:53,name:"Cap de Creus",country:"Spain",region:"Mediterranean",lat:42.32,lng:3.317,diff:"intermediate",cert:"OW",types:["reef","cave"],maxD:35,avgD:15,vis:20,temp:17,current:"moderate",wildlife:["grouper","gorgonian fans","nudibranchs","reef fish"],budget:"low",crowd:"low",rating:4.5,dives:1600,months:[5,6,7,8,9,10],photo:"both",desc:"Costa Brava's wild cape with caves, arches, and gorgonian walls. Tramontane wind creates pristine visibility.",entry:"boat",town:"Cadaqu√©s",wreck:false},
  {id:54,name:"Roat√°n: West End",country:"Honduras",region:"Caribbean",lat:16.331,lng:-86.586,diff:"beginner",cert:"OW",types:["reef","wall"],maxD:40,avgD:18,vis:30,temp:27,current:"light",wildlife:["reef fish","turtles","moray eels","rays"],budget:"low",crowd:"medium",rating:4.6,dives:4800,months:[3,4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"Bay Islands' dive capital. Spectacular wall from 5m with accessible shore diving included.",entry:"shore",town:"West End, Roat√°n",wreck:false},
  {id:55,name:"Apo Island",country:"Philippines",region:"Indo-Pacific",lat:9.08,lng:123.267,diff:"beginner",cert:"OW",types:["reef"],maxD:30,avgD:15,vis:25,temp:27,current:"moderate",wildlife:["turtles","reef fish","sharks"],budget:"low",crowd:"medium",rating:4.7,dives:4800,months:[3,4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"Pioneer marine sanctuary with very tame sea turtles. Community-managed reserve thriving with fish populations.",entry:"boat",town:"Dauin, Dumaguete",wreck:false},
  {id:56,name:"Milne Bay PNG",country:"Papua New Guinea",region:"Pacific Islands",lat:-10.25,lng:150.483,diff:"intermediate",cert:"OW",types:["reef","macro","muck"],maxD:30,avgD:15,vis:20,temp:28,current:"light",wildlife:["nudibranchs","frogfish","seahorses","reef fish"],budget:"high",crowd:"low",rating:4.8,dives:680,months:[10,11,12,1,2,3,4,5,6],photo:"macro",desc:"Legendary macro diving destination. Numerous nudibranch species, pygmy seahorses, and bizarre critters.",entry:"liveaboard",town:"Alotau",wreck:false},
  {id:57,name:"Red Sea: Daedalus Reef",country:"Egypt",region:"Red Sea",lat:24.926,lng:35.869,diff:"advanced",cert:"AOW",types:["reef","wall"],maxD:40,avgD:20,vis:30,temp:26,current:"strong",wildlife:["hammerhead sharks","thresher sharks","manta rays","reef fish"],budget:"high",crowd:"low",rating:4.8,dives:1600,months:[6,7,8,9,10,11],photo:"wide-angle",desc:"Isolated offshore reef with lighthouse. Regular hammerhead and thresher sightings. Spectacular biodiversity.",entry:"liveaboard",town:"Hurghada",wreck:false},
  {id:58,name:"Wakatobi Resort",country:"Indonesia",region:"Indo-Pacific",lat:-5.317,lng:123.9,diff:"beginner",cert:"OW",types:["reef"],maxD:25,avgD:12,vis:25,temp:28,current:"light",wildlife:["reef fish","nudibranchs","turtles","seahorses"],budget:"high",crowd:"low",rating:4.8,dives:1200,months:[10,11,12,1,2,3,4,5,6],photo:"both",desc:"Pristine Wakatobi reefs with exceptional visibility and diverse hard coral gardens. Exclusive luxury diving.",entry:"boat",town:"Wangi-Wangi",wreck:false},
  {id:59,name:"Manado Bay",country:"Indonesia",region:"Indo-Pacific",lat:1.484,lng:124.844,diff:"beginner",cert:"OW",types:["reef","macro","muck"],maxD:30,avgD:15,vis:20,temp:27,current:"light",wildlife:["nudibranchs","frogfish","reef fish","seahorses"],budget:"low",crowd:"medium",rating:4.6,dives:4800,months:[4,5,6,7,8,9,10,11],photo:"macro",desc:"North Sulawesi dive hub. Incredible macro on muck slopes, Bunaken National Park walls just offshore.",entry:"shore",town:"Manado",wreck:false},
  {id:60,name:"Ningaloo Reef",country:"Australia",region:"Pacific Islands",lat:-22.5,lng:113.65,diff:"beginner",cert:"OW",types:["reef"],maxD:30,avgD:12,vis:20,temp:24,current:"light",wildlife:["whale sharks","manta rays","reef fish","turtles"],budget:"medium",crowd:"low",rating:4.8,dives:2800,months:[3,4,5,6,7,8,9],photo:"wide-angle",desc:"World's largest fringing reef with guaranteed whale shark encounters Mar-Aug. Pristine and biodiverse.",entry:"boat",town:"Exmouth",wreck:false},
];



const REGIONS = [...new Set(SITES.map(s => s.region))].sort();
const DIFFICULTIES = ["beginner","intermediate","advanced","technical"];
const DIVE_TYPES = ["reef","wreck","wall","drift","cave","cenote","macro","muck"];
const WILDLIFE_OPTS = ["sharks","manta rays","turtles","dolphins","whales","nudibranchs","frogfish","seahorses","whale sharks","hammerheads"];
const CERTS = ["OW","AOW","Rescue","Tech"];



function filterSites(sites, filters, search) {
  return sites.filter(s => {
    if (filters.region && s.region !== filters.region) return false;
    if (filters.diff && s.diff !== filters.diff) return false;
    if (filters.cert && s.cert !== filters.cert) return false;
    if (filters.type && !s.types.includes(filters.type)) return false;
    if (filters.maxDepth && s.maxD > filters.maxDepth) return false;
    if (filters.wreckOnly && !s.wreck) return false;
    if (filters.wildlife) {
      const wl = filters.wildlife.toLowerCase();
      if (!s.wildlife.some(w => w.toLowerCase().includes(wl))) return false;
    }
    if (search) {
      const q = search.toLowerCase();
      return s.name.toLowerCase().includes(q) || s.country.toLowerCase().includes(q) || s.region.toLowerCase().includes(q);
    }
    return true;
  });
}


    // ============================================================
    // Pure-HTML App State + Rendering
    // ============================================================
    const state = {
      view: "map",       // map | list | site | compare | profile
      selectedId: null,
      filters: {},
      search: "",
      wishlist: [1, 34],
      completed: [2, 6],
      compare: []
    };

    const $ = (sel) => document.querySelector(sel);
    const root = $("#appRoot");
    const toastRoot = $("#toastRoot");

    function escapeHtml(str) {
      return String(str).replace(/[&<>"']/g, (m) => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
    }

    function toast(msg, type="ok") {
      toastRoot.innerHTML = `<div class="toast ${type}">${escapeHtml(msg)}</div>`;
      setTimeout(() => toastRoot.innerHTML = "", 2800);
    }

    function setView(v) {
      state.view = v;
      if (v !== "site") state.selectedId = null;
      render();
    }

    function openSite(id) {
      state.selectedId = id;
      state.view = "site";
      render();
      document.querySelector("main").scrollTop = 0;
    }

    function toggleWishlist(id) {
      const has = state.wishlist.includes(id);
      state.wishlist = has ? state.wishlist.filter(x => x !== id) : [...state.wishlist, id];
      toast(has ? "Removed from wishlist" : "‚ô• Added to wishlist!");
      renderCountsOnly();
      if (state.view === "profile" || state.view === "site") render();
    }

    function toggleCompleted(id) {
      const has = state.completed.includes(id);
      state.completed = has ? state.completed.filter(x => x !== id) : [...state.completed, id];
      toast(has ? "Unmarked" : "‚úì Marked as dived! ü§ø");
      renderCountsOnly();
      if (state.view === "profile" || state.view === "site") render();
    }

    function toggleCompare(id) {
      const site = SITES.find(s => s.id === id);
      const has = state.compare.some(s => s.id === id);
      if (has) {
        state.compare = state.compare.filter(s => s.id !== id);
      } else if (state.compare.length < 3) {
        state.compare = [...state.compare, site];
        toast("Added to compare");
      } else {
        toast("Max 3 sites ‚Äî remove one first", "err");
      }
      renderCountsOnly();
      if (state.view === "compare" || state.view === "site") render();
    }

    function clearFilters() {
      state.filters = {};
      state.search = "";
      render();
    }

    function setFilter(key, value) {
      const v = value === "" ? undefined : value;
      if (!v) delete state.filters[key];
      else state.filters[key] = (key === "maxDepth") ? Number(v) : v;
      render();
    }

    function renderCountsOnly() {
      $("#compareCount").textContent = state.compare.length ? `(${state.compare.length})` : "";
      const fcount = filterSites(SITES, state.filters, state.search).length;
      $("#countPill").textContent = `${fcount} sites`;
    }

    function setActiveNav() {
      const map = $("#navMap"), list = $("#navList"), compare = $("#navCompare"), profile = $("#navProfile");
      [map,list,compare,profile].forEach(b => b.classList.remove("active"));
      if (state.view === "map" || state.view === "site") map.classList.add("active");
      if (state.view === "list") list.classList.add("active");
      if (state.view === "compare") compare.classList.add("active");
      if (state.view === "profile") profile.classList.add("active");
    }

    function siteCard(site) {
      const wl = state.wishlist.includes(site.id);
      const done = state.completed.includes(site.id);
      const inComp = state.compare.some(s => s.id === site.id);

      const types = site.types.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("");
      const tags = `
        <div class="meta">
          <span class="tag gray">${escapeHtml(site.region)}</span>
          <span class="tag alt">${escapeHtml(site.diff)}</span>
          <span class="tag warn">max ${site.maxD}m</span>
          <span class="tag">${escapeHtml(site.cert)}</span>
          ${types}
        </div>
      `;

      return `
        <div class="card">
          <div class="row" style="justify-content:space-between; align-items:flex-start;">
            <div style="min-width:0;">
              <h3>${escapeHtml(site.name)}</h3>
              <div class="muted">${escapeHtml(site.country)} ‚Ä¢ ${escapeHtml(site.town)}</div>
            </div>
            <div class="pill" title="rating">${site.rating} ‚òÖ</div>
          </div>

          <p class="muted" style="margin-top:10px; line-height:1.35;">
            ${escapeHtml(site.desc)}
          </p>

          ${tags}

          <div class="actions">
            <button class="btn primary" data-open="${site.id}">Details</button>
            <button class="btn" data-wl="${site.id}">${wl ? "‚ô• Wishlisted" : "‚ô° Wishlist"}</button>
            <button class="btn" data-done="${site.id}">${done ? "‚úì Dived" : "Mark dived"}</button>
            <button class="btn" data-comp="${site.id}">${inComp ? "Remove compare" : "Compare"}</button>
          </div>
        </div>
      `;
    }

    function renderControls(showExtra) {
      const f = state.filters;
      return `
        <div class="row" style="margin-top:6px;">
          <div class="ctrl">
            <label>Search</label>
            <input id="searchInput" placeholder="Name, country, region‚Ä¶" value="${escapeHtml(state.search)}" />
          </div>

          <div class="ctrl">
            <label>Region</label>
            <select id="regionSel">
              <option value="">All</option>
              ${REGIONS.map(r => `<option ${f.region===r?"selected":""} value="${escapeHtml(r)}">${escapeHtml(r)}</option>`).join("")}
            </select>
          </div>

          <div class="ctrl">
            <label>Difficulty</label>
            <select id="diffSel">
              <option value="">All</option>
              ${DIFFICULTIES.map(d => `<option ${f.diff===d?"selected":""} value="${d}">${d}</option>`).join("")}
            </select>
          </div>

          <div class="ctrl">
            <label>Dive type</label>
            <select id="typeSel">
              <option value="">All</option>
              ${DIVE_TYPES.map(t => `<option ${f.type===t?"selected":""} value="${t}">${t}</option>`).join("")}
            </select>
          </div>

          ${showExtra ? `
          <div class="ctrl">
            <label>Minimum cert</label>
            <select id="certSel">
              <option value="">Any</option>
              ${CERTS.map(c => `<option ${f.cert===c?"selected":""} value="${c}">${c}</option>`).join("")}
            </select>
          </div>

          <div class="ctrl">
            <label>Max depth ‚â§ (m)</label>
            <select id="depthSel">
              <option value="">No limit</option>
              ${[20,30,40,50,60].map(n => `<option ${f.maxDepth===n?"selected":""} value="${n}">${n}m</option>`).join("")}
            </select>
          </div>

          <div class="ctrl">
            <label>Wildlife contains</label>
            <select id="wildSel">
              <option value="">Any</option>
              ${WILDLIFE_OPTS.map(w => `<option ${f.wildlife===w?"selected":""} value="${escapeHtml(w)}">${escapeHtml(w)}</option>`).join("")}
            </select>
          </div>

          <div class="ctrl">
            <label>Wreck only</label>
            <select id="wreckSel">
              <option value="">No</option>
              <option ${f.wreckOnly ? "selected" : ""} value="1">Yes</option>
            </select>
          </div>
          ` : ""}

          <div class="ctrl" style="display:flex; flex-direction:column; justify-content:flex-end;">
            <button class="btn danger" id="clearBtn">Clear</button>
          </div>
        </div>
      `;
    }

    function bindControls(showExtra) {
      $("#searchInput").addEventListener("input", (e) => {
        state.search = e.target.value;
        render();
      });
      $("#regionSel").addEventListener("change", (e) => setFilter("region", e.target.value));
      $("#diffSel").addEventListener("change", (e) => setFilter("diff", e.target.value));
      $("#typeSel").addEventListener("change", (e) => setFilter("type", e.target.value));
      if (showExtra) {
        $("#certSel").addEventListener("change", (e) => setFilter("cert", e.target.value));
        $("#depthSel").addEventListener("change", (e) => setFilter("maxDepth", e.target.value));
        $("#wildSel").addEventListener("change", (e) => setFilter("wildlife", e.target.value));
        $("#wreckSel").addEventListener("change", (e) => {
          if (e.target.value === "1") state.filters.wreckOnly = true;
          else delete state.filters.wreckOnly;
          render();
        });
      }
      $("#clearBtn").addEventListener("click", clearFilters);
    }

    function bindCardActions() {
      root.querySelectorAll("[data-open]").forEach(btn => btn.addEventListener("click", () => openSite(Number(btn.dataset.open))));
      root.querySelectorAll("[data-wl]").forEach(btn => btn.addEventListener("click", () => toggleWishlist(Number(btn.dataset.wl))));
      root.querySelectorAll("[data-done]").forEach(btn => btn.addEventListener("click", () => toggleCompleted(Number(btn.dataset.done))));
      root.querySelectorAll("[data-comp]").forEach(btn => btn.addEventListener("click", () => toggleCompare(Number(btn.dataset.comp))));
    }

    function renderMapView() {
      const filtered = filterSites(SITES, state.filters, state.search);
      const byRegion = {};
      filtered.forEach(s => (byRegion[s.region] ||= []).push(s));
      const regions = Object.keys(byRegion).sort();

      root.innerHTML = `
        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <h2 style="font-size:22px; margin-bottom:6px;">Explore sites</h2>
            <div class="muted">Grouped ‚Äúmap‚Äù view (pure HTML). Use filters to narrow results.</div>
          </div>
          <div class="kpi">
            <div class="box"><div class="num">${state.wishlist.length}</div><div class="lbl">Wishlisted</div></div>
            <div class="box"><div class="num">${state.completed.length}</div><div class="lbl">Dived</div></div>
            <div class="box"><div class="num">${state.compare.length}</div><div class="lbl">Comparing</div></div>
          </div>
        </div>

        ${renderControls(false)}

        <div style="margin-top:14px;" class="split">
          <div class="card">
            <h3>Region index</h3>
            <p class="muted" style="margin-top:6px;">Click a site to open details.</p>
            <div style="margin-top:10px; display:flex; flex-direction:column; gap:10px;">
              ${regions.map(r => `
                <div class="card" style="padding:10px; border-radius:14px;">
                  <div class="row" style="justify-content:space-between;">
                    <div style="font-weight:800;">${escapeHtml(r)}</div>
                    <div class="pill">${byRegion[r].length}</div>
                  </div>
                  <div style="margin-top:8px; display:flex; flex-direction:column; gap:6px;">
                    ${byRegion[r].slice(0, 7).map(s => `
                      <div class="row" style="justify-content:space-between;">
                        <a class="link" href="#site-${s.id}" data-open="${s.id}">${escapeHtml(s.name)}</a>
                        <span class="small muted">${escapeHtml(s.country)}</span>
                      </div>
                    `).join("")}
                    ${byRegion[r].length > 7 ? `<div class="small muted">+ ${byRegion[r].length-7} more</div>` : ""}
                  </div>
                </div>
              `).join("")}
            </div>
          </div>

          <div>
            <div class="row" style="justify-content:space-between; align-items:center;">
              <h3 style="font-size:18px;">Featured results</h3>
              <button class="btn" id="toListBtn">Switch to List</button>
            </div>
            <div class="grid">
              ${filtered.slice(0, 8).map(siteCard).join("")}
            </div>
          </div>
        </div>
      `;

      bindControls(false);
      $("#toListBtn").addEventListener("click", () => setView("list"));
      bindCardActions();
    }

    function renderListView() {
      const filtered = filterSites(SITES, state.filters, state.search);

      root.innerHTML = `
        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <h2 style="font-size:22px; margin-bottom:6px;">All dive sites</h2>
            <div class="muted">${filtered.length} match your filters</div>
          </div>
          <div class="row">
            <span class="pill">‚ô• ${state.wishlist.length}</span>
            <span class="pill">‚úì ${state.completed.length}</span>
          </div>
        </div>

        ${renderControls(true)}

        <div class="grid">
          ${filtered.map(siteCard).join("")}
        </div>
      `;

      bindControls(true);
      bindCardActions();
    }

    function renderSiteDetail() {
      const site = SITES.find(s => s.id === state.selectedId);
      if (!site) { setView("map"); return; }

      const wl = state.wishlist.includes(site.id);
      const done = state.completed.includes(site.id);
      const inComp = state.compare.some(s => s.id === site.id);

      root.innerHTML = `
        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <div class="muted"><a href="#" class="link" id="backLink">‚Üê Back</a></div>
            <h2 style="font-size:26px; margin-top:6px;">${escapeHtml(site.name)}</h2>
            <div class="muted">${escapeHtml(site.town)} ‚Ä¢ ${escapeHtml(site.country)} ‚Ä¢ ${escapeHtml(site.region)}</div>
          </div>
          <div class="row">
            <span class="pill">${site.rating} ‚òÖ</span>
            <span class="pill">${site.dives} dives logged</span>
          </div>
        </div>

        <div class="split" style="margin-top:14px;">
          <div class="card">
            <h3>Overview</h3>
            <p class="muted" style="margin-top:8px; line-height:1.45;">${escapeHtml(site.desc)}</p>

            <div class="meta" style="margin-top:10px;">
              <span class="tag gray">${escapeHtml(site.diff)}</span>
              <span class="tag">${escapeHtml(site.cert)}</span>
              <span class="tag warn">max ${site.maxD}m</span>
              <span class="tag alt">avg ${site.avgD}m</span>
              <span class="tag">vis ${site.vis}m</span>
              <span class="tag">${site.temp}¬∞C</span>
              <span class="tag gray">${escapeHtml(site.current)} current</span>
              ${site.wreck ? `<span class="tag warn">wreck</span>` : ""}
            </div>

            <div style="margin-top:12px;">
              <div class="muted small">Dive types</div>
              <div class="meta" style="margin-top:6px;">
                ${site.types.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
              </div>
            </div>

            <div style="margin-top:12px;">
              <div class="muted small">Wildlife</div>
              <div class="meta" style="margin-top:6px;">
                ${site.wildlife.map(w => `<span class="tag gray">${escapeHtml(w)}</span>`).join("")}
              </div>
            </div>

            <div class="actions" style="margin-top:14px;">
              <button class="btn" id="wlBtn">${wl ? "‚ô• Wishlisted" : "‚ô° Wishlist"}</button>
              <button class="btn" id="doneBtn">${done ? "‚úì Dived" : "Mark dived"}</button>
              <button class="btn" id="compBtn">${inComp ? "Remove compare" : "Compare"}</button>
              <button class="btn primary" id="goCompareBtn" ${state.compare.length ? "" : "disabled"}>Open compare</button>
            </div>
          </div>

          <div class="card">
            <h3>Logistics</h3>
            <div style="margin-top:10px; line-height:1.6;">
              <div><span class="muted">Entry:</span> <b>${escapeHtml(site.entry)}</b></div>
              <div><span class="muted">Budget:</span> <b>${escapeHtml(site.budget)}</b></div>
              <div><span class="muted">Crowd:</span> <b>${escapeHtml(site.crowd)}</b></div>
              <div><span class="muted">Photo style:</span> <b>${escapeHtml(site.photo)}</b></div>
              <div class="muted" style="margin-top:10px;">
                Coordinates: ${site.lat}, ${site.lng}
              </div>
              <div style="margin-top:10px;">
                <a class="link" target="_blank" rel="noopener"
                  href="https://www.openstreetmap.org/?mlat=${site.lat}&mlon=${site.lng}#map=9/${site.lat}/${site.lng}">
                  View on OpenStreetMap
                </a>
              </div>
            </div>

            <div style="margin-top:16px;">
              <h3 style="font-size:16px;">Similar picks</h3>
              <div class="muted small">Same region or type</div>
              <div style="margin-top:10px; display:flex; flex-direction:column; gap:10px;">
                ${SITES
                  .filter(s => s.id !== site.id && (s.region === site.region || s.types.some(t => site.types.includes(t))))
                  .slice(0, 4)
                  .map(s => `
                    <div class="card" style="padding:10px; border-radius:14px;">
                      <div style="font-weight:800;">${escapeHtml(s.name)}</div>
                      <div class="muted small">${escapeHtml(s.country)} ‚Ä¢ ${escapeHtml(s.diff)}</div>
                      <div class="actions" style="margin-top:8px;">
                        <button class="btn primary" data-open="${s.id}">Details</button>
                        <button class="btn" data-comp="${s.id}">${state.compare.some(x=>x.id===s.id)?"Remove compare":"Compare"}</button>
                      </div>
                    </div>
                  `).join("")}
              </div>
            </div>
          </div>
        </div>
      `;

      $("#backLink").addEventListener("click", (e) => { e.preventDefault(); setView("map"); });
      $("#wlBtn").addEventListener("click", () => toggleWishlist(site.id));
      $("#doneBtn").addEventListener("click", () => toggleCompleted(site.id));
      $("#compBtn").addEventListener("click", () => toggleCompare(site.id));
      $("#goCompareBtn").addEventListener("click", () => setView("compare"));
      bindCardActions();
    }

    function renderCompareView() {
      const list = state.compare;
      if (!list.length) {
        root.innerHTML = `
          <div class="card">
            <h2 style="font-size:22px;">Compare</h2>
            <p class="muted" style="margin-top:8px;">Add up to 3 sites to compare from the List or Details view.</p>
            <div class="actions" style="margin-top:12px;">
              <button class="btn primary" id="goList">Go to List</button>
            </div>
          </div>
        `;
        $("#goList").addEventListener("click", () => setView("list"));
        return;
      }

      const rows = [
        ["Location", s => `${escapeHtml(s.town)} ‚Ä¢ ${escapeHtml(s.country)}`],
        ["Region", s => escapeHtml(s.region)],
        ["Difficulty", s => escapeHtml(s.diff)],
        ["Min cert", s => escapeHtml(s.cert)],
        ["Max depth", s => `${s.maxD}m`],
        ["Avg depth", s => `${s.avgD}m`],
        ["Visibility", s => `${s.vis}m`],
        ["Temp", s => `${s.temp}¬∞C`],
        ["Current", s => escapeHtml(s.current)],
        ["Types", s => s.types.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join(" ")],
        ["Wildlife", s => s.wildlife.slice(0,6).map(w => `<span class="tag gray">${escapeHtml(w)}</span>`).join(" ") + (s.wildlife.length>6?` <span class="muted small">+${s.wildlife.length-6}</span>`:"")],
        ["Budget", s => escapeHtml(s.budget)],
        ["Crowd", s => escapeHtml(s.crowd)],
        ["Rating", s => `${s.rating} ‚òÖ`],
        ["Wreck", s => s.wreck ? "Yes" : "No"],
      ];

      root.innerHTML = `
        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <h2 style="font-size:22px; margin-bottom:6px;">Compare sites</h2>
            <div class="muted">Remove any site to add another (max 3).</div>
          </div>
          <div class="row">
            <button class="btn danger" id="clearCompare">Clear compare</button>
          </div>
        </div>

        <div class="row" style="margin-top:10px;">
          ${list.map(s => `
            <div class="card" style="flex:1; min-width:260px;">
              <div class="row" style="justify-content:space-between;">
                <div>
                  <div style="font-weight:900; font-size:16px;">${escapeHtml(s.name)}</div>
                  <div class="muted small">${escapeHtml(s.country)} ‚Ä¢ ${escapeHtml(s.diff)}</div>
                </div>
                <button class="btn" data-comp="${s.id}">Remove</button>
              </div>
              <div class="actions" style="margin-top:10px;">
                <button class="btn primary" data-open="${s.id}">Details</button>
              </div>
            </div>
          `).join("")}
        </div>

        <div style="margin-top:12px;">
          <table>
            <thead>
              <tr>
                <th>Metric</th>
                ${list.map(s => `<th>${escapeHtml(s.name)}</th>`).join("")}
              </tr>
            </thead>
            <tbody>
              ${rows.map(([label, fn]) => `
                <tr>
                  <td class="muted" style="font-weight:800;">${escapeHtml(label)}</td>
                  ${list.map(s => `<td>${fn(s)}</td>`).join("")}
                </tr>
              `).join("")}
            </tbody>
          </table>
        </div>
      `;

      $("#clearCompare").addEventListener("click", () => {
        state.compare = [];
        renderCountsOnly();
        render();
      });
      bindCardActions();
    }

    function renderProfileView() {
      const wl = state.wishlist.map(id => SITES.find(s => s.id === id)).filter(Boolean);
      const done = state.completed.map(id => SITES.find(s => s.id === id)).filter(Boolean);

      root.innerHTML = `
        <div class="row" style="justify-content:space-between; align-items:flex-end;">
          <div>
            <h2 style="font-size:22px; margin-bottom:6px;">Profile</h2>
            <div class="muted">Your saved lists (stored in this page session).</div>
          </div>
          <div class="row">
            <span class="pill">‚ô• ${wl.length}</span>
            <span class="pill">‚úì ${done.length}</span>
          </div>
        </div>

        <div class="split" style="margin-top:14px;">
          <div>
            <h3 style="font-size:18px;">Wishlist</h3>
            <div class="grid">
              ${wl.length ? wl.map(siteCard).join("") : `<div class="card"><div class="muted">No wishlisted sites yet.</div><div class="actions" style="margin-top:10px;"><button class="btn primary" id="goList1">Browse list</button></div></div>`}
            </div>
          </div>

          <div>
            <h3 style="font-size:18px;">Completed</h3>
            <div class="grid">
              ${done.length ? done.map(siteCard).join("") : `<div class="card"><div class="muted">No completed sites yet.</div><div class="actions" style="margin-top:10px;"><button class="btn primary" id="goList2">Browse list</button></div></div>`}
            </div>
          </div>
        </div>
      `;

      const b1 = $("#goList1"); if (b1) b1.addEventListener("click", () => setView("list"));
      const b2 = $("#goList2"); if (b2) b2.addEventListener("click", () => setView("list"));
      bindCardActions();
    }

    function render() {
      setActiveNav();
      renderCountsOnly();

      if (state.view === "map") renderMapView();
      else if (state.view === "list") renderListView();
      else if (state.view === "site") renderSiteDetail();
      else if (state.view === "compare") renderCompareView();
      else if (state.view === "profile") renderProfileView();
    }

    // Nav wiring
    $("#navMap").addEventListener("click", () => setView("map"));
    $("#navList").addEventListener("click", () => setView("list"));
    $("#navCompare").addEventListener("click", () => setView("compare"));
    $("#navProfile").addEventListener("click", () => setView("profile"));

    render();
  </script>
</body>
</html>
