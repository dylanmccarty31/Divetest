<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DiveAtlas</title>

  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel (so the JSX below can run directly in the browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body style="margin:0;">
  <div id="root"></div>

  <script type="text/babel">
const { useState, useEffect, useMemo, useCallback } = React;

// ============================================================
// STYLES
// ============================================================
const STYLES = `
@import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Bebas+Neue&display=swap');
* { box-sizing: border-box; margin: 0; padding: 0; }
body { background: #020817; color: #e2e8f0; }
::-webkit-scrollbar { width: 4px; height: 4px; }
::-webkit-scrollbar-track { background: #0a0f1e; }
::-webkit-scrollbar-thumb { background: #1e3a5f; border-radius: 2px; }
.bebas { font-family: 'Bebas Neue', sans-serif; letter-spacing: 0.05em; }
.btn { padding: 8px 18px; border: none; border-radius: 6px; cursor: pointer; font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600; letter-spacing: 0.06em; transition: all 0.15s ease; }
.btn:hover { filter: brightness(1.15); transform: translateY(-1px); }
.btn-ocean { background: linear-gradient(135deg, #0ea5e9, #0284c7); color: #fff; }
.btn-ghost { background: transparent; color: #64748b; border: 1px solid #1e293b; }
.btn-ghost:hover { border-color: #0ea5e9; color: #0ea5e9; filter: none; }
.btn-danger { background: #ef4444; color: #fff; }
.btn-sm { padding: 5px 12px; font-size: 11px; }
.card { background: #0a1628; border: 1px solid #1e293b; border-radius: 10px; padding: 18px; }
.input { background: #0a0f1e; border: 1px solid #1e293b; color: #e2e8f0; padding: 9px 13px; border-radius: 6px; font-family: 'Space Grotesk', sans-serif; font-size: 13px; outline: none; width: 100%; transition: border-color 0.15s; }
.input:focus { border-color: #0ea5e9; box-shadow: 0 0 0 3px rgba(14,165,233,0.1); }
.select { background: #0a0f1e; border: 1px solid #1e293b; color: #94a3b8; padding: 8px 12px; border-radius: 6px; font-family: 'Space Grotesk', sans-serif; font-size: 12px; outline: none; cursor: pointer; }
.select:focus { border-color: #0ea5e9; }
.tag { display: inline-block; padding: 3px 9px; border-radius: 12px; font-size: 10px; font-weight: 600; letter-spacing: 0.07em; text-transform: uppercase; background: #0f172a; border: 1px solid #1e293b; color: #64748b; }
.fade-in { animation: fadeIn 0.3s ease; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: translateY(0); } }
.glow-ocean { box-shadow: 0 0 24px rgba(14,165,233,0.2); }
.pulse { animation: pulse 2s infinite; }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }
.nav-tab { padding: 10px 18px; border: none; background: transparent; color: #475569; font-family: 'Space Grotesk', sans-serif; font-size: 12px; font-weight: 600; letter-spacing: 0.08em; cursor: pointer; border-bottom: 2px solid transparent; transition: all 0.15s; }
.nav-tab.active { color: #0ea5e9; border-bottom-color: #0ea5e9; }
.nav-tab:hover { color: #94a3b8; }
.notif { position: fixed; bottom: 24px; right: 24px; z-index: 9999; padding: 13px 22px; border-radius: 8px; font-size: 13px; font-weight: 500; animation: slideUp 0.3s ease; }
@keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
.marker { position: absolute; transform: translate(-50%,-50%); cursor: pointer; transition: all 0.15s; }
.marker:hover { z-index: 100; }
.progress-bar { height: 5px; background: #0f172a; border-radius: 3px; overflow: hidden; }
.progress-fill { height: 100%; border-radius: 3px; background: linear-gradient(90deg, #0ea5e9, #22d3ee); transition: width 0.3s; }
`;

// ============================================================
// DATA
// ============================================================
const MONTHS = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const DIFF_COLORS = { beginner:"#10b981", intermediate:"#f59e0b", advanced:"#ef4444", technical:"#8b5cf6" };
const REGION_COLORS = { "Caribbean":"#06b6d4","Red Sea":"#f97316","Indo-Pacific":"#22c55e","Mediterranean":"#a78bfa","Pacific Islands":"#ec4899","Atlantic":"#60a5fa" };

const SITES = [
  {id:1,name:"Great Blue Hole",country:"Belize",region:"Caribbean",lat:17.316,lng:-87.535,diff:"advanced",cert:"AOW",types:["cave","reef"],maxD:40,avgD:20,vis:30,temp:27,current:"light",wildlife:["sharks","grouper","reef fish","stalactites"],budget:"medium",crowd:"high",rating:4.8,dives:3420,months:[11,12,1,2,3,4,5],photo:"wide-angle",desc:"World-famous 300m-wide marine sinkhole. Stalactite formations at depth, Caribbean reef sharks patrol the rim. A bucket-list icon.",entry:"boat",town:"San Pedro, Belize",wreck:false},
  {id:2,name:"Palancar Reef",country:"Mexico",region:"Caribbean",lat:20.348,lng:-87.074,diff:"intermediate",cert:"OW",types:["reef","wall"],maxD:30,avgD:15,vis:35,temp:28,current:"moderate",wildlife:["turtles","eagle rays","moray eels","reef fish"],budget:"medium",crowd:"high",rating:4.7,dives:5200,months:[3,4,5,6,7,8,9,10],photo:"wide-angle",desc:"Cozumel's crown jewel. Towering coral buttresses and swim-throughs teeming with sea turtles and eagle rays.",entry:"boat",town:"San Miguel, Cozumel",wreck:false},
  {id:3,name:"USS Kittiwake",country:"Cayman Islands",region:"Caribbean",lat:19.355,lng:-81.38,diff:"intermediate",cert:"OW",types:["wreck"],maxD:19,avgD:12,vis:25,temp:27,current:"none",wildlife:["turtles","nurse sharks","reef fish"],budget:"medium",crowd:"medium",rating:4.5,dives:2800,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"180-foot submarine rescue vessel deliberately sunk in 2011. Excellent penetration diving through multiple decks.",entry:"shore",town:"Seven Mile Beach, Grand Cayman",wreck:true},
  {id:4,name:"Bloody Bay Wall",country:"Cayman Islands",region:"Caribbean",lat:19.741,lng:-80.09,diff:"intermediate",cert:"OW",types:["wall"],maxD:500,avgD:18,vis:40,temp:27,current:"light",wildlife:["eagle rays","turtles","dolphins","reef fish"],budget:"medium",crowd:"low",rating:4.9,dives:1200,months:[1,2,3,4,5,11,12],photo:"wide-angle",desc:"Little Cayman's legendary wall drops from 6m to 500m. Pristine coral, exceptional visibility, minimal crowds.",entry:"boat",town:"Little Cayman",wreck:false},
  {id:5,name:"Jardines de la Reina",country:"Cuba",region:"Caribbean",lat:20.832,lng:-78.954,diff:"intermediate",cert:"AOW",types:["reef","drift"],maxD:30,avgD:15,vis:30,temp:28,current:"moderate",wildlife:["sharks","grouper","turtles","crocodiles"],budget:"high",crowd:"low",rating:4.9,dives:800,months:[12,1,2,3,4,5],photo:"wide-angle",desc:"Cuba's protected 'Garden of the Queen'. Exceptional shark diversity: silky, reef, and nurse sharks in pristine waters.",entry:"liveaboard",town:"Cienfuegos",wreck:false},
  {id:6,name:"SS Thistlegorm",country:"Egypt",region:"Red Sea",lat:27.812,lng:33.92,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:32,avgD:18,vis:20,temp:24,current:"moderate",wildlife:["reef fish","barracuda","batfish","moray eels"],budget:"low",crowd:"high",rating:4.9,dives:15000,months:[9,10,11,12,1,2,3,4,5],photo:"wide-angle",desc:"World's most famous WWII wreck. British merchant ship packed with motorcycles, trucks, and military equipment.",entry:"boat",town:"Sharm el-Sheikh",wreck:true},
  {id:7,name:"Ras Mohammed",country:"Egypt",region:"Red Sea",lat:27.736,lng:34.242,diff:"intermediate",cert:"OW",types:["reef","wall","drift"],maxD:40,avgD:20,vis:30,temp:24,current:"moderate",wildlife:["reef fish","sharks","barracuda","jacks"],budget:"low",crowd:"medium",rating:4.8,dives:8900,months:[9,10,11,12,1,2,3,4,5,6],photo:"wide-angle",desc:"Egypt's premier marine park. Dramatic walls festooned with sea fans. Famous jackfish tornado in the blue water.",entry:"boat",town:"Sharm el-Sheikh",wreck:false},
  {id:8,name:"Blue Hole Dahab",country:"Egypt",region:"Red Sea",lat:28.573,lng:34.539,diff:"technical",cert:"Tech",types:["cave","wall"],maxD:100,avgD:30,vis:30,temp:22,current:"none",wildlife:["reef fish","turtles","napoleon wrasse"],budget:"low",crowd:"medium",rating:4.7,dives:6200,months:[9,10,11,12,1,2,3,4,5,6],photo:"wide-angle",desc:"Sinai's legendary submarine sinkhole. The arch at 56m leads to the wall. A rite of passage for serious divers.",entry:"shore",town:"Dahab",wreck:false},
  {id:9,name:"Brother Islands",country:"Egypt",region:"Red Sea",lat:26.323,lng:34.847,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:20,vis:30,temp:25,current:"strong",wildlife:["sharks","manta rays","thresher sharks","hammerheads"],budget:"high",crowd:"low",rating:4.9,dives:2100,months:[4,5,6,7,8,9,10],photo:"wide-angle",desc:"Remote twin islands ‚Äî Egypt's best shark action. Oceanic whitetip, hammerhead, silvertip and grey reef sharks.",entry:"liveaboard",town:"Hurghada",wreck:false},
  {id:10,name:"Elphinstone Reef",country:"Egypt",region:"Red Sea",lat:24.887,lng:35.034,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:22,vis:30,temp:25,current:"strong",wildlife:["sharks","dolphins","reef fish"],budget:"medium",crowd:"medium",rating:4.8,dives:3400,months:[9,10,11,12,1,2,3,4],photo:"wide-angle",desc:"Spectacular elongated reef with dramatic overhangs. Oceanic whitetip sharks circle the plateau.",entry:"boat",town:"Marsa Alam",wreck:false},
  {id:11,name:"Komodo National Park",country:"Indonesia",region:"Indo-Pacific",lat:-8.557,lng:119.49,diff:"advanced",cert:"AOW",types:["reef","drift"],maxD:40,avgD:18,vis:20,temp:26,current:"strong",wildlife:["manta rays","sharks","dolphins","reef fish"],budget:"medium",crowd:"medium",rating:4.9,dives:6800,months:[4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"Dramatic drift dives through volcanic island channels. Manta rays at cleaning stations, incredible coral diversity.",entry:"liveaboard",town:"Labuan Bajo",wreck:false},
  {id:12,name:"Tulamben USAT Liberty",country:"Indonesia",region:"Indo-Pacific",lat:-8.273,lng:115.59,diff:"beginner",cert:"OW",types:["wreck","macro"],maxD:29,avgD:10,vis:20,temp:27,current:"none",wildlife:["nudibranchs","frogfish","bumphead parrotfish","reef fish"],budget:"low",crowd:"medium",rating:4.7,dives:9200,months:[4,5,6,7,8,9,10,11],photo:"macro",desc:"WWII cargo ship sunk by Japanese torpedo, now draped in stunning coral. Shore dive with incredible critter diversity.",entry:"shore",town:"Tulamben, Bali",wreck:true},
  {id:13,name:"Manta Point Nusa Penida",country:"Indonesia",region:"Indo-Pacific",lat:-8.76,lng:115.46,diff:"intermediate",cert:"OW",types:["reef"],maxD:20,avgD:10,vis:15,temp:26,current:"moderate",wildlife:["manta rays","reef fish","turtles"],budget:"low",crowd:"high",rating:4.8,dives:7800,months:[7,8,9,10,11],photo:"wide-angle",desc:"Bali's famous manta cleaning station. Up to 15 giant mantas circling overhead as cleaner wrasse tend to them.",entry:"boat",town:"Nusa Penida, Bali",wreck:false},
  {id:14,name:"Raja Ampat: Misool",country:"Indonesia",region:"Indo-Pacific",lat:-2.083,lng:130.167,diff:"intermediate",cert:"OW",types:["reef","macro"],maxD:40,avgD:15,vis:25,temp:28,current:"moderate",wildlife:["reef fish","sharks","nudibranchs","wobbegongs"],budget:"high",crowd:"low",rating:4.9,dives:1800,months:[10,11,12,1,2,3,4,5,6],photo:"both",desc:"Heart of the Coral Triangle. Staggering biodiversity, remote island setting, extraordinary soft corals and sea fans.",entry:"liveaboard",town:"Sorong",wreck:false},
  {id:15,name:"Lembeh Strait",country:"Indonesia",region:"Indo-Pacific",lat:1.466,lng:125.242,diff:"intermediate",cert:"OW",types:["muck","macro"],maxD:25,avgD:10,vis:10,temp:27,current:"light",wildlife:["frogfish","nudibranchs","seahorses","mimic octopus","mantis shrimp"],budget:"medium",crowd:"medium",rating:4.9,dives:5400,months:[1,2,3,4,5,10,11,12],photo:"macro",desc:"World capital of muck diving. Mimic octopus, hairy frogfish, blue-ringed octopus ‚Äî more weird life per dive than anywhere.",entry:"shore",town:"Bitung, North Sulawesi",wreck:false},
  {id:16,name:"Blue Corner",country:"Palau",region:"Pacific Islands",lat:7.108,lng:134.218,diff:"advanced",cert:"AOW",types:["reef","drift"],maxD:40,avgD:20,vis:30,temp:28,current:"strong",wildlife:["sharks","barracuda","napoleon wrasse","reef fish"],budget:"high",crowd:"medium",rating:4.9,dives:4200,months:[10,11,12,1,2,3,4,5],photo:"wide-angle",desc:"Palau's most famous dive. Reef hook in and watch the parade of grey reef sharks, whitetips, and massive fish schools.",entry:"boat",town:"Koror",wreck:false},
  {id:17,name:"Truk Lagoon",country:"Micronesia",region:"Pacific Islands",lat:7.35,lng:151.85,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:40,avgD:20,vis:25,temp:28,current:"light",wildlife:["reef fish","sharks","turtles","anemonefish"],budget:"high",crowd:"low",rating:4.9,dives:2800,months:[12,1,2,3,4,5,6,7],photo:"wide-angle",desc:"World's greatest wreck diving. 60+ Japanese WWII ships sunk in Operation Hailstone. Ghostly cargo holds.",entry:"liveaboard",town:"Weno, Chuuk",wreck:true},
  {id:18,name:"Richelieu Rock",country:"Thailand",region:"Indo-Pacific",lat:9.445,lng:97.827,diff:"intermediate",cert:"AOW",types:["reef","macro"],maxD:35,avgD:15,vis:20,temp:28,current:"moderate",wildlife:["whale sharks","manta rays","nudibranchs","seahorses"],budget:"medium",crowd:"medium",rating:4.9,dives:5600,months:[11,12,1,2,3,4,5],photo:"both",desc:"Thailand's greatest dive site. Submerged pinnacle teeming with life. Whale sharks Jan-May. Remarkable biodiversity.",entry:"liveaboard",town:"Khao Lak",wreck:false},
  {id:19,name:"Sipadan",country:"Malaysia",region:"Indo-Pacific",lat:4.115,lng:118.628,diff:"intermediate",cert:"OW",types:["wall","reef"],maxD:40,avgD:18,vis:30,temp:28,current:"moderate",wildlife:["turtles","sharks","barracuda tornado","reef fish"],budget:"high",crowd:"medium",rating:4.9,dives:4800,months:[4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"Malaysia's only oceanic island. Turtle Cavern, Barracuda Point with spiraling tornado, prolific shark action.",entry:"boat",town:"Semporna, Sabah",wreck:false},
  {id:20,name:"Great Barrier Reef: Osprey",country:"Australia",region:"Pacific Islands",lat:-13.883,lng:146.533,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:20,vis:40,temp:24,current:"strong",wildlife:["sharks","manta rays","dolphins","reef fish"],budget:"high",crowd:"low",rating:4.9,dives:1400,months:[9,10,11,12,1,2,3],photo:"wide-angle",desc:"Remote Coral Sea atoll. North Horn shark feeding, pristine walls to 1000m depth, exceptional visibility.",entry:"liveaboard",town:"Cairns",wreck:false},
  {id:21,name:"Gozo Blue Hole",country:"Malta",region:"Mediterranean",lat:36.051,lng:14.19,diff:"intermediate",cert:"AOW",types:["cave","wall"],maxD:40,avgD:18,vis:30,temp:19,current:"light",wildlife:["grouper","octopus","bream","reef fish"],budget:"low",crowd:"medium",rating:4.7,dives:4800,months:[5,6,7,8,9,10,11],photo:"wide-angle",desc:"Malta's iconic blue hole and natural chimney leading to spectacular wall. Cathedral-like light effects.",entry:"shore",town:"Dwejra, Gozo",wreck:false},
  {id:22,name:"Zenobia",country:"Cyprus",region:"Mediterranean",lat:34.942,lng:33.917,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:42,avgD:22,vis:25,temp:20,current:"light",wildlife:["barracuda","grouper","turtles","reef fish"],budget:"low",crowd:"medium",rating:4.8,dives:6200,months:[5,6,7,8,9,10,11],photo:"wide-angle",desc:"Europe's best wreck dive. Swedish ferry sunk 1980, laden with trucks, lying on its side at 43m.",entry:"boat",town:"Larnaca",wreck:true},
  {id:23,name:"Coron Wrecks",country:"Philippines",region:"Indo-Pacific",lat:11.983,lng:120.2,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:38,avgD:20,vis:15,temp:27,current:"light",wildlife:["reef fish","turtles","barracuda"],budget:"low",crowd:"medium",rating:4.8,dives:4200,months:[11,12,1,2,3,4,5,6],photo:"wide-angle",desc:"12 Japanese WWII warships in a breathtaking island setting. Heavily coral-encrusted with excellent penetration.",entry:"boat",town:"Coron Town, Palawan",wreck:true},
  {id:24,name:"Tubbataha Reef",country:"Philippines",region:"Indo-Pacific",lat:8.85,lng:119.917,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:20,vis:40,temp:28,current:"strong",wildlife:["sharks","manta rays","dolphins","reef fish"],budget:"high",crowd:"low",rating:4.9,dives:1600,months:[3,4,5,6],photo:"wide-angle",desc:"UNESCO World Heritage site in the Sulu Sea. Liveaboard only. Pristine walls, huge shark diversity.",entry:"liveaboard",town:"Puerto Princesa, Palawan",wreck:false},
  {id:25,name:"Thresher Shark Malapascua",country:"Philippines",region:"Indo-Pacific",lat:10.133,lng:124.217,diff:"advanced",cert:"AOW",types:["reef"],maxD:35,avgD:25,vis:30,temp:27,current:"moderate",wildlife:["thresher sharks","reef fish","hammerheads"],budget:"low",crowd:"medium",rating:4.8,dives:3200,months:[3,4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"Malapascua's famous thresher shark cleaning station. Dawn dives at Monad Shoal deliver thresher sightings.",entry:"boat",town:"Malapascua Island, Cebu",wreck:false},
  {id:26,name:"Anilao",country:"Philippines",region:"Indo-Pacific",lat:13.667,lng:120.9,diff:"beginner",cert:"OW",types:["macro","muck"],maxD:25,avgD:10,vis:15,temp:27,current:"light",wildlife:["nudibranchs","frogfish","seahorses","bobtail squid","mantis shrimp"],budget:"low",crowd:"medium",rating:4.7,dives:5600,months:[11,12,1,2,3,4,5],photo:"macro",desc:"Philippines' macro capital. Hundreds of nudibranch species, hairy frogfish ‚Äî a macro photographer's dream.",entry:"shore",town:"Batangas",wreck:false},
  {id:27,name:"Manta Point Baa Atoll",country:"Maldives",region:"Indo-Pacific",lat:5.1,lng:73.017,diff:"beginner",cert:"OW",types:["reef"],maxD:15,avgD:8,vis:20,temp:28,current:"moderate",wildlife:["manta rays","reef fish","whale sharks"],budget:"high",crowd:"medium",rating:4.9,dives:3800,months:[5,6,7,8,9,10],photo:"wide-angle",desc:"World's largest manta ray aggregation during Southwest Monsoon. Up to 200 mantas feeding in Hanifaru Bay.",entry:"boat",town:"Eydhafushi, Baa Atoll",wreck:false},
  {id:28,name:"Hammerhead Point Rasdhoo",country:"Maldives",region:"Indo-Pacific",lat:4.267,lng:72.967,diff:"advanced",cert:"AOW",types:["reef","drift"],maxD:40,avgD:20,vis:30,temp:28,current:"strong",wildlife:["hammerhead sharks","manta rays","reef fish"],budget:"high",crowd:"low",rating:4.8,dives:1200,months:[12,1,2,3,4,5],photo:"wide-angle",desc:"Rasdhoo Atoll's famous hammerhead school. Early morning dives reward with schools of scalloped hammerheads.",entry:"boat",town:"Rasdhoo",wreck:false},
  {id:29,name:"Cenote Dos Ojos",country:"Mexico",region:"Caribbean",lat:20.338,lng:-87.402,diff:"intermediate",cert:"AOW",types:["cenote","cave"],maxD:20,avgD:10,vis:60,temp:24,current:"none",wildlife:["cave fish","stalactites","halocline"],budget:"low",crowd:"high",rating:4.8,dives:8900,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"Riviera Maya's most famous cenote. 'Two Eyes' twin caverns with otherworldly 60m visibility through limestone passages.",entry:"shore",town:"Tulum",wreck:false},
  {id:30,name:"Cenote Angelita",country:"Mexico",region:"Caribbean",lat:20.192,lng:-87.478,diff:"advanced",cert:"Tech",types:["cenote","cave"],maxD:60,avgD:30,vis:40,temp:24,current:"none",wildlife:["cave fish","hydrogen sulfide cloud"],budget:"medium",crowd:"low",rating:4.9,dives:1200,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"Extraordinary hydrogen sulfide cloud at 30m creates a ghostly 'river' separating fresh and salt water layers.",entry:"shore",town:"Tulum",wreck:false},
  {id:31,name:"Silfra Fissure",country:"Iceland",region:"Atlantic",lat:64.259,lng:-21.121,diff:"intermediate",cert:"OW",types:["cave","drift"],maxD:18,avgD:10,vis:100,temp:3,current:"light",wildlife:["arctic algae","arctic fish","amphipods"],budget:"medium",crowd:"medium",rating:4.7,dives:3200,months:[5,6,7,8,9],photo:"wide-angle",desc:"Dive between tectonic plates of America and Europe. Glacial meltwater gives 100m visibility. Ethereal landscapes.",entry:"shore",town:"Reykjavik",wreck:false},
  {id:32,name:"Scapa Flow",country:"UK",region:"Atlantic",lat:58.9,lng:-3.1,diff:"intermediate",cert:"AOW",types:["wreck"],maxD:45,avgD:25,vis:15,temp:8,current:"moderate",wildlife:["reef fish","nudibranchs","crabs","anemones"],budget:"medium",crowd:"low",rating:4.8,dives:3400,months:[5,6,7,8,9],photo:"wide-angle",desc:"Orkney's famous German WWI fleet scuttling. Seven battleships and cruisers. Historic cold-water wreck diving.",entry:"boat",town:"Stromness, Orkney",wreck:true},
  {id:33,name:"Azores: Princess Alice",country:"Portugal",region:"Atlantic",lat:37.2,lng:-24.25,diff:"advanced",cert:"AOW",types:["reef","drift"],maxD:40,avgD:20,vis:30,temp:20,current:"strong",wildlife:["manta rays","mobula rays","blue sharks","dolphins","whales"],budget:"high",crowd:"low",rating:4.9,dives:680,months:[5,6,7,8,9,10],photo:"wide-angle",desc:"Remote Mid-Atlantic seamount. Mobula rays by the thousands, manta rays, blue sharks. Extraordinary pelagic action.",entry:"liveaboard",town:"Horta, Faial",wreck:false},
  {id:34,name:"Galapagos Wolf Island",country:"Ecuador",region:"Pacific Islands",lat:1.4,lng:-91.817,diff:"advanced",cert:"AOW",types:["reef","drift","wall"],maxD:40,avgD:20,vis:15,temp:20,current:"strong",wildlife:["hammerhead sharks","whale sharks","Galapagos sharks","manta rays","marine iguanas"],budget:"high",crowd:"low",rating:4.9,dives:1200,months:[6,7,8,9,10,11,12,1,2],photo:"wide-angle",desc:"Holy grail of diving. Schooling hammerheads, whale sharks, marine iguanas ‚Äî dramatic volcanic wall diving.",entry:"liveaboard",town:"Puerto Baquerizo Moreno",wreck:false},
  {id:35,name:"Cocos Island",country:"Costa Rica",region:"Pacific Islands",lat:5.533,lng:-87.067,diff:"advanced",cert:"AOW",types:["reef","drift","wall"],maxD:40,avgD:22,vis:20,temp:27,current:"strong",wildlife:["hammerhead sharks","manta rays","dolphins","whales"],budget:"high",crowd:"low",rating:4.9,dives:920,months:[5,6,7,8,9,10,11,12,1,2],photo:"wide-angle",desc:"UNESCO Heritage Site. Thousands of scalloped hammerheads at Manuelita. One of the world's top 3 dives.",entry:"liveaboard",town:"Puntarenas",wreck:false},
  {id:36,name:"SS President Coolidge",country:"Vanuatu",region:"Pacific Islands",lat:-15.508,lng:167.187,diff:"advanced",cert:"AOW",types:["wreck"],maxD:65,avgD:25,vis:25,temp:26,current:"light",wildlife:["reef fish","turtles","barracuda","lion fish"],budget:"medium",crowd:"low",rating:4.8,dives:2200,months:[4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"WWII luxury liner sunk by own mines. Massive wreck with cargo hold artifacts and luxury fittings intact.",entry:"shore",town:"Luganville, Espiritu Santo",wreck:true},
  {id:37,name:"Sodwana Bay",country:"South Africa",region:"Indo-Pacific",lat:-27.533,lng:32.683,diff:"intermediate",cert:"AOW",types:["reef","macro"],maxD:30,avgD:18,vis:15,temp:22,current:"moderate",wildlife:["sharks","rays","turtles","reef fish","raggedtooth sharks"],budget:"low",crowd:"medium",rating:4.5,dives:3200,months:[11,12,1,2,3,4],photo:"both",desc:"Southernmost coral reef in Africa. Ragged-tooth shark nursery, exceptional macro life, rare endemic species.",entry:"boat",town:"Mkuze",wreck:false},
  {id:38,name:"Great White Cage Gansbaai",country:"South Africa",region:"Indo-Pacific",lat:-34.817,lng:19.633,diff:"beginner",cert:"OW",types:["reef"],maxD:5,avgD:3,vis:10,temp:14,current:"moderate",wildlife:["great white sharks"],budget:"medium",crowd:"high",rating:4.7,dives:8900,months:[6,7,8,9,10,11],photo:"wide-angle",desc:"Cage dive with the ocean's apex predator. Great white sharks up to 5m circling the cage at Shark Alley.",entry:"boat",town:"Gansbaai, Western Cape",wreck:false},
  {id:39,name:"Mozambique: Tofo",country:"Mozambique",region:"Indo-Pacific",lat:-23.867,lng:35.533,diff:"intermediate",cert:"OW",types:["reef","drift"],maxD:30,avgD:15,vis:15,temp:25,current:"moderate",wildlife:["whale sharks","manta rays","dolphins","reef fish"],budget:"low",crowd:"low",rating:4.7,dives:2200,months:[10,11,12,1,2,3,4,5,6],photo:"wide-angle",desc:"Africa's marine megafauna capital. Year-round whale sharks, resident manta rays, humpback whales Jul-Nov.",entry:"boat",town:"Tofo",wreck:false},
  {id:40,name:"Fernando de Noronha",country:"Brazil",region:"Atlantic",lat:-3.858,lng:-32.426,diff:"intermediate",cert:"OW",types:["reef","drift","wall"],maxD:40,avgD:18,vis:40,temp:27,current:"strong",wildlife:["spinner dolphins","spinner sharks","turtles","reef fish"],budget:"high",crowd:"low",rating:4.9,dives:1200,months:[9,10,11,12,1,2,3,4],photo:"wide-angle",desc:"Brazil's UNESCO paradise island. Spinner dolphin bay, extraordinary 40m visibility, vibrant marine life.",entry:"boat",town:"Vila dos Rem√©dios",wreck:false},
  {id:41,name:"Bonaire: Salt Pier",country:"Bonaire",region:"Caribbean",lat:12.104,lng:-68.284,diff:"beginner",cert:"OW",types:["reef","macro"],maxD:20,avgD:10,vis:25,temp:27,current:"none",wildlife:["seahorses","frogfish","moray eels","nudibranchs"],budget:"low",crowd:"medium",rating:4.6,dives:4800,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"macro",desc:"Bonaire's most photogenic pier. Massive encrusted pylons full of macro life, seahorses, and frogfish up close.",entry:"shore",town:"Kralendijk",wreck:false},
  {id:42,name:"Yap Manta Bay",country:"Micronesia",region:"Pacific Islands",lat:9.533,lng:138.133,diff:"intermediate",cert:"OW",types:["reef"],maxD:20,avgD:10,vis:20,temp:28,current:"moderate",wildlife:["manta rays","reef fish","turtles"],budget:"high",crowd:"low",rating:4.8,dives:1400,months:[12,1,2,3,4,5,6,7],photo:"wide-angle",desc:"Yap's famous manta channel. Resident manta rays visit cleaning stations year-round. Culturally rich destination.",entry:"boat",town:"Colonia, Yap",wreck:false},
  {id:43,name:"Bikini Atoll",country:"Marshall Islands",region:"Pacific Islands",lat:11.5,lng:165.383,diff:"advanced",cert:"AOW",types:["wreck"],maxD:55,avgD:30,vis:30,temp:28,current:"moderate",wildlife:["sharks","reef fish","large pelagics"],budget:"high",crowd:"low",rating:4.9,dives:180,months:[3,4,5,6,7,8],photo:"wide-angle",desc:"UNESCO World Heritage Site. Nuclear test site with massive fleet including USS Saratoga and Nagato battleship.",entry:"liveaboard",town:"Majuro",wreck:true},
  {id:44,name:"Rangiroa: Tiputa Pass",country:"French Polynesia",region:"Pacific Islands",lat:-14.967,lng:-147.65,diff:"advanced",cert:"AOW",types:["drift","reef"],maxD:40,avgD:20,vis:40,temp:27,current:"strong",wildlife:["dolphins","hammerhead sharks","manta rays","reef fish"],budget:"medium",crowd:"low",rating:4.8,dives:1800,months:[6,7,8,9,10,11,12,1],photo:"wide-angle",desc:"One of the world's great drift dives. Hundreds of dolphins, hammerheads, and mantas in crystal atoll passes.",entry:"boat",town:"Avatoru, Rangiroa",wreck:false},
  {id:45,name:"Fakarava South Pass",country:"French Polynesia",region:"Pacific Islands",lat:-16.617,lng:-145.45,diff:"advanced",cert:"AOW",types:["drift","reef"],maxD:40,avgD:20,vis:40,temp:27,current:"strong",wildlife:["grey reef sharks","reef fish","dolphins"],budget:"medium",crowd:"low",rating:4.9,dives:1200,months:[6,7,8,9,10],photo:"wide-angle",desc:"UNESCO Biosphere Reserve. 600+ grey reef sharks hunting the pass during spawning season. Epic spectacle.",entry:"boat",town:"Rotoava, Fakarava",wreck:false},
  {id:46,name:"Kona Manta Night Dive",country:"USA",region:"Pacific Islands",lat:19.567,lng:-155.983,diff:"beginner",cert:"OW",types:["reef"],maxD:12,avgD:8,vis:15,temp:25,current:"none",wildlife:["manta rays","reef fish","plankton"],budget:"medium",crowd:"high",rating:4.9,dives:15000,months:[1,2,3,4,5,6,7,8,9,10,11,12],photo:"wide-angle",desc:"World's most famous manta ray night dive. Divers' torches attract plankton, bringing 10-20 mantas doing barrel rolls.",entry:"boat",town:"Kailua-Kona, Big Island",wreck:false},
  {id:47,name:"Socorro: Roca Partida",country:"Mexico",region:"Pacific Islands",lat:19.0,lng:-112.067,diff:"advanced",cert:"AOW",types:["reef","wall","drift"],maxD:40,avgD:25,vis:30,temp:22,current:"strong",wildlife:["manta rays","whale sharks","silky sharks","dolphins","tuna"],budget:"high",crowd:"low",rating:4.9,dives:580,months:[11,12,1,2,3,4,5],photo:"wide-angle",desc:"Revillagigedo's remote pinnacle. 360¬∞ diving on a tiny volcanic rock with whitetips, mantas, and silky sharks.",entry:"liveaboard",town:"Cabo San Lucas",wreck:false},
  {id:48,name:"Poor Knights Islands",country:"New Zealand",region:"Pacific Islands",lat:-35.467,lng:174.733,diff:"intermediate",cert:"OW",types:["cave","wall","reef"],maxD:40,avgD:18,vis:25,temp:18,current:"moderate",wildlife:["fish","rays","dolphins","moray eels"],budget:"medium",crowd:"low",rating:4.7,dives:2400,months:[12,1,2,3,4,5],photo:"wide-angle",desc:"Jacques Cousteau's Top 10 dive location. Dramatic volcanic arches and caverns, richest subtropical NZ marine life.",entry:"boat",town:"Tutukaka, Northland",wreck:false},
  {id:49,name:"Tonga Humpback Whales",country:"Tonga",region:"Pacific Islands",lat:-19.75,lng:-174.35,diff:"beginner",cert:"OW",types:["reef"],maxD:20,avgD:10,vis:30,temp:24,current:"light",wildlife:["humpback whales","reef fish","turtles"],budget:"high",crowd:"low",rating:4.9,dives:680,months:[7,8,9,10],photo:"wide-angle",desc:"In-water humpback whale encounters. Mothers, calves, and singers in Ha'apai's shallow warm waters. Magical.",entry:"liveaboard",town:"Pangai",wreck:false},
  {id:50,name:"Fiji: Great White Wall",country:"Fiji",region:"Pacific Islands",lat:-16.817,lng:-179.933,diff:"advanced",cert:"AOW",types:["wall","drift"],maxD:40,avgD:25,vis:30,temp:26,current:"strong",wildlife:["reef fish","sharks","dolphins","sea fans"],budget:"high",crowd:"low",rating:4.8,dives:2200,months:[7,8,9,10,11,12,1,2,3,4],photo:"wide-angle",desc:"Taveuni's legendary dive. Vertical wall carpeted entirely in white soft coral. Spectacular color contrast.",entry:"boat",town:"Matagi Island, Taveuni",wreck:false},
  {id:51,name:"Portofino Marine Reserve",country:"Italy",region:"Mediterranean",lat:44.298,lng:9.217,diff:"beginner",cert:"OW",types:["reef","macro"],maxD:25,avgD:12,vis:15,temp:18,current:"none",wildlife:["gorgonian fans","grouper","octopus","moray eels"],budget:"medium",crowd:"medium",rating:4.4,dives:2800,months:[5,6,7,8,9,10],photo:"both",desc:"Ligurian marine reserve with stunning red gorgonian forests. Giant grouper roam the cathedral rocks.",entry:"boat",town:"Portofino",wreck:false},
  {id:52,name:"Sardinia: Nereo Cave",country:"Italy",region:"Mediterranean",lat:40.65,lng:8.1,diff:"intermediate",cert:"AOW",types:["cave","reef"],maxD:35,avgD:15,vis:30,temp:19,current:"light",wildlife:["grouper","bream","lobsters","reef fish"],budget:"low",crowd:"low",rating:4.5,dives:2200,months:[5,6,7,8,9,10,11],photo:"wide-angle",desc:"Mediterranean's largest accessible sea cave. Cavernous chambers with bioluminescence and enormous grouper.",entry:"boat",town:"Capo Caccia, Alghero",wreck:false},
  {id:53,name:"Cap de Creus",country:"Spain",region:"Mediterranean",lat:42.32,lng:3.317,diff:"intermediate",cert:"OW",types:["reef","cave"],maxD:35,avgD:15,vis:20,temp:17,current:"moderate",wildlife:["grouper","gorgonian fans","nudibranchs","reef fish"],budget:"low",crowd:"low",rating:4.5,dives:1600,months:[5,6,7,8,9,10],photo:"both",desc:"Costa Brava's wild cape with caves, arches, and gorgonian walls. Tramontane wind creates pristine visibility.",entry:"boat",town:"Cadaqu√©s",wreck:false},
  {id:54,name:"Roat√°n: West End",country:"Honduras",region:"Caribbean",lat:16.331,lng:-86.586,diff:"beginner",cert:"OW",types:["reef","wall"],maxD:40,avgD:18,vis:30,temp:27,current:"light",wildlife:["reef fish","turtles","moray eels","rays"],budget:"low",crowd:"medium",rating:4.6,dives:4800,months:[3,4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"Bay Islands' dive capital. Spectacular wall from 5m with accessible shore diving included.",entry:"shore",town:"West End, Roat√°n",wreck:false},
  {id:55,name:"Apo Island",country:"Philippines",region:"Indo-Pacific",lat:9.08,lng:123.267,diff:"beginner",cert:"OW",types:["reef"],maxD:30,avgD:15,vis:25,temp:27,current:"moderate",wildlife:["turtles","reef fish","sharks"],budget:"low",crowd:"medium",rating:4.7,dives:4800,months:[3,4,5,6,7,8,9,10,11],photo:"wide-angle",desc:"Pioneer marine sanctuary with very tame sea turtles. Community-managed reserve thriving with fish populations.",entry:"boat",town:"Dauin, Dumaguete",wreck:false},
  {id:56,name:"Milne Bay PNG",country:"Papua New Guinea",region:"Pacific Islands",lat:-10.25,lng:150.483,diff:"intermediate",cert:"OW",types:["reef","macro","muck"],maxD:30,avgD:15,vis:20,temp:28,current:"light",wildlife:["nudibranchs","frogfish","seahorses","reef fish"],budget:"high",crowd:"low",rating:4.8,dives:680,months:[10,11,12,1,2,3,4,5,6],photo:"macro",desc:"Legendary macro diving destination. Numerous nudibranch species, pygmy seahorses, and bizarre critters.",entry:"liveaboard",town:"Alotau",wreck:false},
  {id:57,name:"Red Sea: Daedalus Reef",country:"Egypt",region:"Red Sea",lat:24.926,lng:35.869,diff:"advanced",cert:"AOW",types:["reef","wall"],maxD:40,avgD:20,vis:30,temp:26,current:"strong",wildlife:["hammerhead sharks","thresher sharks","manta rays","reef fish"],budget:"high",crowd:"low",rating:4.8,dives:1600,months:[6,7,8,9,10,11],photo:"wide-angle",desc:"Isolated offshore reef with lighthouse. Regular hammerhead and thresher sightings. Spectacular biodiversity.",entry:"liveaboard",town:"Hurghada",wreck:false},
  {id:58,name:"Wakatobi Resort",country:"Indonesia",region:"Indo-Pacific",lat:-5.317,lng:123.9,diff:"beginner",cert:"OW",types:["reef"],maxD:25,avgD:12,vis:25,temp:28,current:"light",wildlife:["reef fish","nudibranchs","turtles","seahorses"],budget:"high",crowd:"low",rating:4.8,dives:1200,months:[10,11,12,1,2,3,4,5,6],photo:"both",desc:"Pristine Wakatobi reefs with exceptional visibility and diverse hard coral gardens. Exclusive luxury diving.",entry:"boat",town:"Wangi-Wangi",wreck:false},
  {id:59,name:"Manado Bay",country:"Indonesia",region:"Indo-Pacific",lat:1.484,lng:124.844,diff:"beginner",cert:"OW",types:["reef","macro","muck"],maxD:30,avgD:15,vis:20,temp:27,current:"light",wildlife:["nudibranchs","frogfish","reef fish","seahorses"],budget:"low",crowd:"medium",rating:4.6,dives:4800,months:[4,5,6,7,8,9,10,11],photo:"macro",desc:"North Sulawesi dive hub. Incredible macro on muck slopes, Bunaken National Park walls just offshore.",entry:"shore",town:"Manado",wreck:false},
  {id:60,name:"Ningaloo Reef",country:"Australia",region:"Pacific Islands",lat:-22.5,lng:113.65,diff:"beginner",cert:"OW",types:["reef"],maxD:30,avgD:12,vis:20,temp:24,current:"light",wildlife:["whale sharks","manta rays","reef fish","turtles"],budget:"medium",crowd:"low",rating:4.8,dives:2800,months:[3,4,5,6,7,8,9],photo:"wide-angle",desc:"World's largest fringing reef with guaranteed whale shark encounters Mar-Aug. Pristine and biodiverse.",entry:"boat",town:"Exmouth",wreck:false},
];

const REGIONS = [...new Set(SITES.map(s => s.region))].sort();
const DIFFICULTIES = ["beginner","intermediate","advanced","technical"];
const DIVE_TYPES = ["reef","wreck","wall","drift","cave","cenote","macro","muck"];
const WILDLIFE_OPTS = ["sharks","manta rays","turtles","dolphins","whales","nudibranchs","frogfish","seahorses","whale sharks","hammerheads"];
const CERTS = ["OW","AOW","Rescue","Tech"];

function filterSites(sites, filters, search) {
  return sites.filter(s => {
    if (filters.region && s.region !== filters.region) return false;
    if (filters.diff && s.diff !== filters.diff) return false;
    if (filters.cert && s.cert !== filters.cert) return false;
    if (filters.type && !s.types.includes(filters.type)) return false;
    if (filters.maxDepth && s.maxD > filters.maxDepth) return false;
    if (filters.wreckOnly && !s.wreck) return false;
    if (filters.wildlife) {
      const wl = filters.wildlife.toLowerCase();
      if (!s.wildlife.some(w => w.toLowerCase().includes(wl))) return false;
    }
    if (search) {
      const q = search.toLowerCase();
      return s.name.toLowerCase().includes(q) || s.country.toLowerCase().includes(q) || s.region.toLowerCase().includes(q);
    }
    return true;
  });
}

// ============================================================
// MAIN APP
// ============================================================
function DiveAtlas() {
  const [view, setView] = useState("map");
  const [selected, setSelected] = useState(null);
  const [filters, setFilters] = useState({});
  const [search, setSearch] = useState("");
  const [wishlist, setWishlist] = useState([1, 34]);
  const [completed, setCompleted] = useState([2, 6]);
  const [compareList, setCompareList] = useState([]);
  const [user, setUser] = useState(null);
  const [showLogin, setShowLogin] = useState(false);
  const [loginForm, setLoginForm] = useState({ email: "", pass: "" });
  const [notif, setNotif] = useState(null);

  const filtered = useMemo(() => filterSites(SITES, filters, search), [filters, search]);

  const toast = useCallback((msg, type="ok") => {
    setNotif({ msg, type });
    setTimeout(() => setNotif(null), 3000);
  }, []);

  const toggleWishlist = (id) => {
    const has = wishlist.includes(id);
    setWishlist(p => has ? p.filter(x => x !== id) : [...p, id]);
    toast(has ? "Removed from wishlist" : "‚ô• Added to wishlist!");
  };
  const toggleCompleted = (id) => {
    const has = completed.includes(id);
    setCompleted(p => has ? p.filter(x => x !== id) : [...p, id]);
    toast(has ? "Unmarked" : "‚úì Marked as dived! ü§ø");
  };
  const addToCompare = (site) => {
    if (compareList.find(s => s.id === site.id)) {
      setCompareList(p => p.filter(s => s.id !== site.id));
    } else if (compareList.length < 3) {
      setCompareList(p => [...p, site]);
      toast("Added to compare");
    } else {
      toast("Max 3 sites ‚Äî remove one first", "err");
    }
  };

  const openSite = (site) => { setSelected(site); setView("site"); };

  return (
    <>
      <style>{STYLES}</style>
      <div style={{ fontFamily:"'Space Grotesk',sans-serif", background:"#020817", color:"#e2e8f0", height:"100vh", display:"flex", flexDirection:"column", overflow:"hidden" }}>
        {/* HEADER */}
        <header style={{ background:"#020817", borderBottom:"1px solid #0f172a", height:52, display:"flex", alignItems:"center", padding:"0 20px", gap:0, flexShrink:0, zIndex:200 }}>
          <div style={{ display:"flex", alignItems:"center", gap:10, marginRight:28 }}>
            <span style={{ fontSize:20 }}>ü§ø</span>
            <span className="bebas" style={{ fontSize:22, color:"#0ea5e9", letterSpacing:"0.08em" }}>DiveAtlas</span>
          </div>
          <nav style={{ display:"flex", flex:1 }}>
            {[
              {id:"map",label:"MAP"},
              {id:"list",label:"SITES"},
              {id:"compare",label:`COMPARE${compareList.length ? ` (${compareList.length})` : ""}`},
              {id:"profile",label:"LOGBOOK"},
            ].map(n => (
              <button key={n.id} className={`nav-tab ${view===n.id?"active":""}`} onClick={() => setView(n.id)}>{n.label}</button>
            ))}
          </nav>
          <div style={{ display:"flex", alignItems:"center", gap:10 }}>
            <span style={{ fontSize:11, color:"#334155" }}>{filtered.length} sites</span>
            {user ? (
              <div style={{ display:"flex", alignItems:"center", gap:8 }}>
                <span style={{ fontSize:11, color:"#475569" }}>{wishlist.length}‚ô• {completed.length}‚úì</span>
                <div style={{ width:30, height:30, borderRadius:"50%", background:"#0c4a6e", border:"2px solid #0ea5e9", display:"flex", alignItems:"center", justifyContent:"center", cursor:"pointer", fontSize:13 }}
                  onClick={() => setView("profile")}>{user.name[0].toUpperCase()}</div>
              </div>
            ) : (
              <button className="btn btn-ocean btn-sm" onClick={() => setShowLogin(true)}>SIGN IN</button>
            )}
          </div>
        </header>

        {/* VIEWS */}
        <div style={{ flex:1, overflow:"hidden", position:"relative" }}>
          {view === "map" && <MapView sites={filtered} allSites={SITES} filters={filters} setFilters={setFilters} search={search} setSearch={setSearch} wishlist={wishlist} completed={completed} toggleWishlist={toggleWishlist} compareList={compareList} addToCompare={addToCompare} onOpenSite={openSite} />}
          {view === "list" && <ListView sites={filtered} filters={filters} setFilters={setFilters} search={search} setSearch={setSearch} wishlist={wishlist} toggleWishlist={toggleWishlist} completed={completed} compareList={compareList} addToCompare={addToCompare} onOpen={openSite} />}
          {view === "site" && selected && <SiteDetail site={selected} onBack={() => setView("map")} wishlist={wishlist} toggleWishlist={toggleWishlist} completed={completed} toggleCompleted={toggleCompleted} compareList={compareList} addToCompare={addToCompare} user={user} />}
          {view === "compare" && <CompareView compareList={compareList} setCompareList={setCompareList} allSites={SITES} addToCompare={addToCompare} onOpen={openSite} />}
          {view === "profile" && <ProfileView user={user} setUser={setUser} wishlist={wishlist} completed={completed} allSites={SITES} onOpen={openSite} />}
        </div>

        {/* LOGIN MODAL */}
        {showLogin && (
          <div style={{ position:"fixed", inset:0, background:"rgba(0,0,0,0.85)", zIndex:999, display:"flex", alignItems:"center", justifyContent:"center" }}
            onClick={() => setShowLogin(false)}>
            <div className="card fade-in" style={{ width:340, padding:32 }} onClick={e => e.stopPropagation()}>
              <div className="bebas" style={{ fontSize:24, color:"#0ea5e9", marginBottom:24 }}>SIGN IN TO DIVEATLAS</div>
              <div style={{ marginBottom:14 }}>
                <div style={{ fontSize:11, color:"#64748b", marginBottom:5, fontWeight:600, letterSpacing:"0.07em" }}>EMAIL</div>
                <input className="input" type="email" placeholder="ocean@diver.com" value={loginForm.email} onChange={e => setLoginForm({...loginForm, email:e.target.value})} />
              </div>
              <div style={{ marginBottom:24 }}>
                <div style={{ fontSize:11, color:"#64748b", marginBottom:5, fontWeight:600, letterSpacing:"0.07em" }}>PASSWORD</div>
                <input className="input" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value={loginForm.pass} onChange={e => setLoginForm({...loginForm, pass:e.target.value})} onKeyDown={e => e.key==="Enter" && doLogin()} />
              </div>
              <button className="btn btn-ocean" style={{ width:"100%", padding:13, fontSize:13 }}
                onClick={() => { if(loginForm.email && loginForm.pass) { setUser({name:loginForm.email.split("@")[0], email:loginForm.email, cert:"AOW", dives:142}); setShowLogin(false); toast("Welcome back! ü§ø"); } }}>
                SIGN IN
              </button>
              <div style={{ textAlign:"center", marginTop:14, fontSize:11, color:"#475569" }}>Any email + any password for demo</div>
            </div>
          </div>
        )}

        {/* NOTIFICATION */}
        {notif && (
          <div className="notif" style={{ background: notif.type==="err" ? "#450a0a" : "#022c22", border:`1px solid ${notif.type==="err"?"#ef4444":"#10b981"}`, color:notif.type==="err"?"#fca5a5":"#6ee7b7" }}>
            {notif.msg}
          </div>
        )}
      </div>
    </>
  );
}

// ============================================================
// MAP VIEW
// ============================================================
function MapView({ sites, allSites, filters, setFilters, search, setSearch, wishlist, completed, toggleWishlist, compareList, addToCompare, onOpenSite }) {
  const [showFilters, setShowFilters] = useState(false);
  const [hovered, setHovered] = useState(null);
  const [suggestions, setSuggestions] = useState([]);

  const handleSearch = (q) => {
    setSearch(q);
    setSuggestions(q.length > 1 ? SITES.filter(s => s.name.toLowerCase().includes(q.toLowerCase()) || s.country.toLowerCase().includes(q.toLowerCase())).slice(0,5) : []);
  };

  const project = (lat, lng) => {
    const x = ((lng + 180) / 360) * 100;
    const latRad = lat * Math.PI / 180;
    const mercN = Math.log(Math.tan(Math.PI/4 + latRad/2));
    const y = ((1 - mercN/Math.PI)/2) * 100;
    return { x: Math.max(0.5, Math.min(99.5, x)), y: Math.max(2, Math.min(97, y)) };
  };

  return (
    <div style={{ height:"100%", display:"flex" }}>
      {/* Filter sidebar */}
      <div style={{ width:showFilters?270:0, overflow:"hidden", transition:"width 0.28s ease", background:"#020817", borderRight:"1px solid #0f172a", flexShrink:0 }}>
        <div style={{ width:270, padding:18, overflowY:"auto", height:"100%" }}>
          <div style={{ fontSize:11, fontWeight:700, letterSpacing:"0.1em", color:"#475569", marginBottom:16 }}>FILTERS</div>
          {[
            {label:"REGION", key:"region", opts:REGIONS},
            {label:"DIFFICULTY", key:"diff", opts:DIFFICULTIES},
            {label:"CERTIFICATION", key:"cert", opts:CERTS},
            {label:"DIVE TYPE", key:"type", opts:DIVE_TYPES},
          ].map(f => (
            <div key={f.key} style={{ marginBottom:12 }}>
              <div style={{ fontSize:10, color:"#475569", marginBottom:5, letterSpacing:"0.07em", fontWeight:600 }}>{f.label}</div>
              <select className="select" style={{ width:"100%" }} value={filters[f.key]||""} onChange={e => setFilters({...filters,[f.key]:e.target.value||undefined})}>
                <option value="">ALL</option>
                {f.opts.map(o => <option key={o} value={o}>{o.toUpperCase()}</option>)}
              </select>
            </div>
          ))}
          <div style={{ marginBottom:12 }}>
            <div style={{ fontSize:10, color:"#475569", marginBottom:5, letterSpacing:"0.07em", fontWeight:600 }}>MAX DEPTH</div>
            <input type="range" min="10" max="100" step="5" value={filters.maxDepth||100} onChange={e => setFilters({...filters, maxDepth:parseInt(e.target.value)})} style={{ width:"100%", accentColor:"#0ea5e9" }} />
            <div style={{ fontSize:10, color:"#64748b", marginTop:2 }}>Up to {filters.maxDepth||100}m</div>
          </div>
          <div style={{ marginBottom:12 }}>
            <div style={{ fontSize:10, color:"#475569", marginBottom:5, letterSpacing:"0.07em", fontWeight:600 }}>WILDLIFE</div>
            <select className="select" style={{ width:"100%" }} value={filters.wildlife||""} onChange={e => setFilters({...filters, wildlife:e.target.value||undefined})}>
              <option value="">ANY</option>
              {WILDLIFE_OPTS.map(w => <option key={w} value={w}>{w.toUpperCase()}</option>)}
            </select>
          </div>
          <label style={{ display:"flex", alignItems:"center", gap:8, cursor:"pointer", marginBottom:16 }}>
            <input type="checkbox" checked={!!filters.wreckOnly} onChange={e => setFilters({...filters, wreckOnly:e.target.checked||undefined})} style={{ accentColor:"#0ea5e9" }} />
            <span style={{ fontSize:12, color:"#94a3b8" }}>WRECKS ONLY</span>
          </label>
          <button className="btn btn-ghost btn-sm" style={{ width:"100%" }} onClick={() => setFilters({})}>CLEAR ALL</button>
          
          <div style={{ marginTop:20, borderTop:"1px solid #0f172a", paddingTop:14 }}>
            <div style={{ fontSize:10, fontWeight:700, color:"#475569", letterSpacing:"0.08em", marginBottom:10 }}>üåä BEST THIS MONTH</div>
            {SITES.filter(s => s.months.includes(new Date().getMonth()+1)).slice(0,5).map(s => (
              <div key={s.id} style={{ fontSize:11, color:"#64748b", padding:"4px 0", cursor:"pointer", display:"flex", alignItems:"center", gap:6 }}
                onClick={() => onOpenSite(s)}>
                <div style={{ width:6, height:6, borderRadius:"50%", background:DIFF_COLORS[s.diff] }} />
                {s.name}
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* Map */}
      <div style={{ flex:1, position:"relative", background:"#020d1c", overflow:"hidden" }}>
        {/* Toolbar */}
        <div style={{ position:"absolute", top:14, left:14, zIndex:50, display:"flex", gap:8, alignItems:"center" }}>
          <button className={`btn btn-sm ${showFilters?"btn-ocean":"btn-ghost"}`} onClick={() => setShowFilters(p=>!p)}>
            ‚öô FILTERS{Object.keys(filters).length>0 ? ` (${Object.keys(filters).length})` : ""}
          </button>
          <div style={{ position:"relative" }}>
            <input className="input" placeholder="Search sites or countries..." value={search} onChange={e => handleSearch(e.target.value)} style={{ width:230, paddingLeft:30 }} />
            <span style={{ position:"absolute", left:10, top:"50%", transform:"translateY(-50%)", fontSize:12, color:"#475569" }}>üîç</span>
            {suggestions.length > 0 && (
              <div style={{ position:"absolute", top:"calc(100% + 4px)", left:0, width:"100%", background:"#0a1628", border:"1px solid #1e293b", borderRadius:6, zIndex:200 }}>
                {suggestions.map(s => (
                  <div key={s.id} style={{ padding:"9px 12px", cursor:"pointer", fontSize:12, borderBottom:"1px solid #0f172a" }}
                    onMouseEnter={e => e.currentTarget.style.background="#0f172a"} onMouseLeave={e => e.currentTarget.style.background="transparent"}
                    onClick={() => { onOpenSite(s); setSuggestions([]); setSearch(""); }}>
                    <div>{s.name}</div>
                    <div style={{ fontSize:10, color:"#475569" }}>{s.country} ¬∑ {s.region}</div>
                  </div>
                ))}
              </div>
            )}
          </div>
          <span style={{ fontSize:11, color:"#334155" }}>{sites.length}/{SITES.length}</span>
        </div>

        {/* Legend */}
        <div style={{ position:"absolute", bottom:14, left:14, zIndex:50, background:"rgba(2,8,23,0.92)", border:"1px solid #0f172a", borderRadius:8, padding:"10px 14px" }}>
          {Object.entries(DIFF_COLORS).map(([d,c]) => (
            <div key={d} style={{ display:"flex", alignItems:"center", gap:7, marginBottom:4, fontSize:10, color:"#64748b" }}>
              <div style={{ width:8, height:8, borderRadius:"50%", background:c }} />{d.toUpperCase()}
            </div>
          ))}
          <div style={{ marginTop:8, paddingTop:8, borderTop:"1px solid #0f172a", fontSize:9, color:"#334155" }}>
            {compareList.length > 0 && <span style={{ color:"#f59e0b" }}>‚óè comparing</span>}
          </div>
        </div>

        {/* Compare strip */}
        {compareList.length > 0 && (
          <div style={{ position:"absolute", bottom:14, right:14, zIndex:50, background:"rgba(2,8,23,0.95)", border:"1px solid #0ea5e9", borderRadius:8, padding:"10px 14px", display:"flex", alignItems:"center", gap:8 }}>
            <span style={{ fontSize:10, color:"#475569", fontWeight:600 }}>COMPARE:</span>
            {compareList.map(s => <span key={s.id} style={{ fontSize:11, color:"#38bdf8", background:"#0c4a6e22", padding:"2px 8px", borderRadius:10 }}>{s.name.split(":")[0]}</span>)}
          </div>
        )}

        {/* SVG World Map */}
        <svg width="100%" height="100%" viewBox="0 0 100 60" preserveAspectRatio="xMidYMid meet" style={{ position:"absolute", inset:0 }}>
          <defs>
            <radialGradient id="oceanG" cx="40%" cy="50%" r="80%">
              <stop offset="0%" stopColor="#021530" />
              <stop offset="100%" stopColor="#010a18" />
            </radialGradient>
            <filter id="markerGlow">
              <feGaussianBlur stdDeviation="0.4" result="blur"/>
              <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
            </filter>
          </defs>
          <rect width="100" height="60" fill="url(#oceanG)" />
          
          {/* Lat/Lng grid */}
          {[-60,-30,0,30,60].map(lat => { const p = project(lat,0); return <line key={lat} x1="0" y1={p.y} x2="100" y2={p.y} stroke="#051828" strokeWidth="0.08" strokeDasharray="0.3,0.8" />; })}
          {[-120,-60,0,60,120].map(lng => { const p = project(0,lng); return <line key={lng} x1={p.x} y1="0" x2={p.x} y2="60" stroke="#051828" strokeWidth="0.08" strokeDasharray="0.3,0.8" />; })}

          {/* Simplified Continents */}
          <g fill="#071c35" stroke="#0a2e4f" strokeWidth="0.15">
            {/* North America */}
            <path d="M 6,6 L 22,5 L 24,8 L 22,14 L 20,22 L 16,28 L 13,26 L 10,22 L 7,16 Z" />
            {/* Central America */}
            <path d="M 14,28 L 18,27 L 19,30 L 17,33 L 14,31 Z" />
            {/* South America */}
            <path d="M 16,33 L 26,33 L 28,40 L 26,50 L 20,52 L 16,47 L 15,40 Z" />
            {/* Greenland */}
            <path d="M 24,3 L 33,3 L 33,9 L 27,11 L 23,8 Z" />
            {/* Europe */}
            <path d="M 44,8 L 54,7 L 56,12 L 52,16 L 48,16 L 44,12 Z" />
            {/* UK */}
            <path d="M 43,9 L 46,8 L 47,11 L 44,12 Z" />
            {/* Africa */}
            <path d="M 43,17 L 56,17 L 57,24 L 55,36 L 50,44 L 45,44 L 41,36 L 41,24 Z" />
            {/* Russia/Siberia */}
            <path d="M 52,5 L 90,4 L 92,10 L 85,14 L 60,16 L 52,12 Z" />
            {/* Middle East */}
            <path d="M 55,17 L 66,17 L 68,23 L 62,26 L 56,23 Z" />
            {/* South Asia */}
            <path d="M 64,22 L 78,22 L 78,28 L 72,32 L 65,28 Z" />
            {/* SE Asia mainland */}
            <path d="M 74,26 L 82,26 L 82,32 L 78,34 L 73,32 Z" />
            {/* Australia */}
            <path d="M 74,36 L 88,36 L 90,44 L 84,48 L 76,46 L 73,41 Z" />
            {/* New Zealand */}
            <path d="M 89,44 L 92,43 L 92,48 L 89,49 Z" />
            {/* Japan */}
            <path d="M 83,20 L 86,19 L 87,23 L 84,24 Z" />
            {/* Antarctica */}
            <rect x="0" y="57" width="100" height="3" />
          </g>

          {/* Ocean labels */}
          {[{t:"PACIFIC OCEAN",x:87,y:42},{t:"ATLANTIC OCEAN",x:29,y:40},{t:"INDIAN OCEAN",x:65,y:46},{t:"ARCTIC",x:50,y:4}].map(l => (
            <text key={l.t} x={l.x} y={l.y} fill="#0b2840" fontSize="1.8" textAnchor="middle" fontFamily="'Bebas Neue',sans-serif" letterSpacing="0.3">{l.t}</text>
          ))}

          {/* Dive site markers */}
          {sites.map(site => {
            const {x, y} = project(site.lat, site.lng);
            const col = DIFF_COLORS[site.diff];
            const isHov = hovered?.id === site.id;
            const inComp = compareList.find(s => s.id === site.id);
            const done = completed.includes(site.id);
            const wishl = wishlist.includes(site.id);
            const r = isHov ? 1.0 : inComp ? 0.85 : 0.55;
            return (
              <g key={site.id} style={{ cursor:"pointer" }}
                onMouseEnter={() => setHovered(site)} onMouseLeave={() => setHovered(null)}
                onClick={() => onOpenSite(site)}>
                {isHov && (
                  <circle cx={x} cy={y} r={2} fill="none" stroke={col} strokeWidth="0.15" opacity="0.6">
                    <animate attributeName="r" from="0.8" to="3.5" dur="1.2s" repeatCount="indefinite"/>
                    <animate attributeName="opacity" from="0.7" to="0" dur="1.2s" repeatCount="indefinite"/>
                  </circle>
                )}
                <circle cx={x} cy={y} r={r} fill={inComp ? "#f59e0b" : done ? "#10b981" : col} stroke={wishl ? "#fbbf24" : "rgba(255,255,255,0.25)"} strokeWidth="0.12" filter="url(#markerGlow)" opacity={isHov?1:0.9} />
                {isHov && (
                  <text x={x+1.2} y={y-0.6} fill="#f1f5f9" fontSize="1.1" fontFamily="'Space Grotesk',sans-serif" fontWeight="600">{site.name.length>22?site.name.slice(0,20)+"‚Ä¶":site.name}</text>
                )}
              </g>
            );
          })}
        </svg>

        {/* Hover preview card */}
        {hovered && (
          <div className="fade-in" style={{ position:"absolute", top:"50%", right:18, transform:"translateY(-50%)", width:250, zIndex:100, pointerEvents:"none" }}>
            <div style={{ background:"rgba(10,22,40,0.97)", border:"1px solid #1e3a5f", borderRadius:10, padding:16, backdropFilter:"blur(12px)" }}>
              <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:8 }}>
                <div style={{ fontSize:13, fontWeight:700, color:"#f1f5f9", lineHeight:1.2, flex:1 }}>{hovered.name}</div>
                <span style={{ background:DIFF_COLORS[hovered.diff]+"22", color:DIFF_COLORS[hovered.diff], border:`1px solid ${DIFF_COLORS[hovered.diff]}44`, padding:"2px 7px", borderRadius:10, fontSize:9, fontWeight:700, marginLeft:6, flexShrink:0 }}>{hovered.diff.toUpperCase()}</span>
              </div>
              <div style={{ fontSize:10, color:"#475569", marginBottom:10 }}>{hovered.country} ¬∑ {hovered.region}</div>
              <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr 1fr", gap:6, marginBottom:10 }}>
                {[["DEPTH",`${hovered.maxD}m`],["VIS",`${hovered.vis}m`],["TEMP",`${hovered.temp}¬∞C`]].map(([l,v]) => (
                  <div key={l} style={{ textAlign:"center", background:"#060d1a", borderRadius:5, padding:"5px 0" }}>
                    <div style={{ fontSize:13, color:"#38bdf8", fontWeight:600 }}>{v}</div>
                    <div style={{ fontSize:8, color:"#334155", letterSpacing:"0.05em" }}>{l}</div>
                  </div>
                ))}
              </div>
              <div style={{ display:"flex", gap:4, flexWrap:"wrap", marginBottom:8 }}>
                {hovered.types.map(t => <span key={t} className="tag" style={{ fontSize:8 }}>{t}</span>)}
              </div>
              <div style={{ fontSize:10, color:"#22d3ee", marginBottom:8 }}>
                {hovered.wildlife.slice(0,3).map(w => `üê† ${w}`).join("  ")}
              </div>
              <div style={{ display:"flex", alignItems:"center", gap:6 }}>
                <span style={{ color:"#fbbf24", fontSize:12 }}>{"‚òÖ".repeat(Math.floor(hovered.rating))}</span>
                <span style={{ fontSize:11, color:"#64748b" }}>{hovered.rating} ¬∑ {hovered.dives.toLocaleString()} dives</span>
              </div>
              {wishlist.includes(hovered.id) && <div style={{ fontSize:9, color:"#f59e0b", marginTop:6 }}>‚ô• In your wishlist</div>}
              {completed.includes(hovered.id) && <div style={{ fontSize:9, color:"#10b981", marginTop:3 }}>‚úì You've dived this!</div>}
              <div style={{ fontSize:9, color:"#334155", marginTop:8, borderTop:"1px solid #0f172a", paddingTop:7 }}>CLICK FOR FULL DETAILS ‚Üí</div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// ============================================================
// LIST VIEW
// ============================================================
function ListView({ sites, filters, setFilters, search, setSearch, wishlist, toggleWishlist, completed, compareList, addToCompare, onOpen }) {
  const [sort, setSort] = useState("rating");
  const [page, setPage] = useState(1);
  const PER = 18;

  const sorted = [...sites].sort((a,b) => sort==="rating"?b.rating-a.rating:sort==="depth"?b.maxD-a.maxD:sort==="name"?a.name.localeCompare(b.name):b.temp-a.temp);
  const paged = sorted.slice((page-1)*PER, page*PER);
  const pages = Math.ceil(sorted.length/PER);

  return (
    <div style={{ height:"100%", overflow:"auto", padding:"20px 24px" }}>
      <div style={{ display:"flex", alignItems:"center", gap:12, marginBottom:18, flexWrap:"wrap" }}>
        <div className="bebas" style={{ fontSize:26, color:"#e2e8f0" }}>DIVE SITES</div>
        <div style={{ fontSize:12, color:"#334155", flex:1 }}>{sites.length} results</div>
        <input className="input" style={{ width:200 }} placeholder="Search..." value={search} onChange={e => setSearch(e.target.value)} />
        <select className="select" value={sort} onChange={e => setSort(e.target.value)}>
          <option value="rating">‚Üì RATING</option>
          <option value="depth">‚Üì DEPTH</option>
          <option value="name">A-Z NAME</option>
          <option value="temp">‚Üì TEMP</option>
        </select>
      </div>

      {/* Quick difficulty filter */}
      <div style={{ display:"flex", gap:6, marginBottom:18, flexWrap:"wrap" }}>
        {DIFFICULTIES.map(d => (
          <button key={d} className="btn btn-sm" onClick={() => setFilters({...filters, diff:filters.diff===d?undefined:d})} style={{ background:filters.diff===d?DIFF_COLORS[d]:"transparent", color:filters.diff===d?"#fff":DIFF_COLORS[d], border:`1px solid ${DIFF_COLORS[d]}` }}>{d.toUpperCase()}</button>
        ))}
        {Object.keys(filters).length>0 && <button className="btn btn-ghost btn-sm" onClick={() => setFilters({})}>‚úï CLEAR</button>}
      </div>

      <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))", gap:12 }}>
        {paged.map(site => <SiteCard key={site.id} site={site} wishlist={wishlist} toggleWishlist={toggleWishlist} completed={completed} compareList={compareList} addToCompare={addToCompare} onClick={() => onOpen(site)} />)}
      </div>

      {pages > 1 && (
        <div style={{ display:"flex", justifyContent:"center", alignItems:"center", gap:10, marginTop:24 }}>
          <button className="btn btn-ghost btn-sm" onClick={() => setPage(p => Math.max(1,p-1))} disabled={page===1}>‚Üê</button>
          <span style={{ fontSize:12, color:"#475569" }}>Page {page} of {pages}</span>
          <button className="btn btn-ghost btn-sm" onClick={() => setPage(p => Math.min(pages,p+1))} disabled={page===pages}>‚Üí</button>
        </div>
      )}
    </div>
  );
}

function SiteCard({ site, wishlist, toggleWishlist, completed, compareList, addToCompare, onClick }) {
  const wishl = wishlist.includes(site.id);
  const done = completed.includes(site.id);
  const inComp = compareList.find(s => s.id === site.id);
  const best = site.months.includes(new Date().getMonth()+1);

  return (
    <div className="card" style={{ cursor:"pointer", transition:"all 0.15s", position:"relative" }}
      onMouseEnter={e => { e.currentTarget.style.borderColor="#1e3a5f"; e.currentTarget.style.transform="translateY(-2px)"; }}
      onMouseLeave={e => { e.currentTarget.style.borderColor="#1e293b"; e.currentTarget.style.transform="none"; }}
      onClick={onClick}>
      {best && <div style={{ position:"absolute", top:12, right:12, background:"#052e16", color:"#4ade80", padding:"2px 8px", borderRadius:10, fontSize:9, fontWeight:700, letterSpacing:"0.07em" }}>BEST NOW</div>}
      <div style={{ display:"flex", justifyContent:"space-between", alignItems:"flex-start", marginBottom:8 }}>
        <div>
          <div style={{ fontSize:14, fontWeight:700, color:"#f1f5f9", marginBottom:2 }}>{done && "‚úì "}{site.name}</div>
          <div style={{ fontSize:11, color:"#475569" }}>{site.country} ¬∑ {site.region}</div>
        </div>
        <span style={{ background:DIFF_COLORS[site.diff]+"22", color:DIFF_COLORS[site.diff], border:`1px solid ${DIFF_COLORS[site.diff]}44`, padding:"3px 8px", borderRadius:10, fontSize:10, fontWeight:700, whiteSpace:"nowrap" }}>{site.diff}</span>
      </div>

      <div style={{ display:"grid", gridTemplateColumns:"repeat(4,1fr)", gap:6, marginBottom:10 }}>
        {[["DEPTH",`${site.maxD}m`],["VIS",`${site.vis}m`],["TEMP",`${site.temp}¬∞`],["RATING",site.rating]].map(([l,v]) => (
          <div key={l} style={{ textAlign:"center", background:"#060d1a", borderRadius:5, padding:"5px 2px" }}>
            <div style={{ fontSize:12, color:"#38bdf8", fontWeight:600 }}>{v}</div>
            <div style={{ fontSize:8, color:"#334155", letterSpacing:"0.04em" }}>{l}</div>
          </div>
        ))}
      </div>

      <div style={{ display:"flex", gap:4, flexWrap:"wrap", marginBottom:8 }}>
        {site.types.map(t => <span key={t} className="tag">{t}</span>)}
        {site.wreck && <span className="tag" style={{ borderColor:"#92400e", color:"#fb923c" }}>WRECK</span>}
      </div>
      <div style={{ fontSize:10, color:"#0891b2", marginBottom:10 }}>
        {site.wildlife.slice(0,3).map(w => `üê† ${w}`).join("  ")}
      </div>

      <div style={{ display:"flex", gap:6, paddingTop:10, borderTop:"1px solid #0f172a" }} onClick={e => e.stopPropagation()}>
        <button className="btn btn-sm" style={{ flex:1, background:wishl?"#450a0a":"#0a0f1e", color:wishl?"#f87171":"#475569", border:`1px solid ${wishl?"#7f1d1d":"#1e293b"}` }} onClick={() => toggleWishlist(site.id)}>
          {wishl?"‚ô• SAVED":"‚ô° WISHLIST"}
        </button>
        <button className="btn btn-sm" style={{ flex:1, background:inComp?"#0c2346":"#0a0f1e", color:inComp?"#60a5fa":"#475569", border:`1px solid ${inComp?"#1d4ed8":"#1e293b"}` }} onClick={() => addToCompare(site)}>
          {inComp?"‚Äî REMOVE":"+ COMPARE"}
        </button>
      </div>
    </div>
  );
}

// ============================================================
// SITE DETAIL
// ============================================================
function SiteDetail({ site, onBack, wishlist, toggleWishlist, completed, toggleCompleted, compareList, addToCompare, user }) {
  const [tab, setTab] = useState("overview");
  const wishl = wishlist.includes(site.id);
  const done = completed.includes(site.id);
  const inComp = compareList.find(s => s.id === site.id);
  const TABS = ["overview","conditions","wildlife","logistics","safety"];

  const mockReviews = [
    {who:"NautilusDiver",when:"2024-11",stars:5,text:"Absolutely incredible. The marine life surpassed all expectations. Visibility was perfect ‚Äî will definitely return."},
    {who:"SaltWaterSam",when:"2024-10",stars:4,text:"Strong currents made it challenging but rewarding. Experienced divers will love the sheer volume of life."},
    {who:"CoralQueen",when:"2024-09",stars:5,text:"Peak season gave perfect conditions. Saw everything on the wildlife list in one dive. Unforgettable."},
  ];

  return (
    <div style={{ height:"100%", overflow:"auto", background:"#020817" }}>
      {/* Sticky header */}
      <div style={{ background:"linear-gradient(135deg,#041830,#051f3d,#030d1a)", borderBottom:"1px solid #0f172a", padding:"18px 28px", position:"sticky", top:0, zIndex:100 }}>
        <div style={{ display:"flex", alignItems:"flex-start", gap:14 }}>
          <button className="btn btn-ghost btn-sm" onClick={onBack}>‚Üê BACK</button>
          <div style={{ flex:1 }}>
            <div style={{ display:"flex", alignItems:"center", gap:10, flexWrap:"wrap" }}>
              <div className="bebas" style={{ fontSize:26, color:"#f1f5f9" }}>{site.name}</div>
              <span style={{ background:DIFF_COLORS[site.diff]+"22", color:DIFF_COLORS[site.diff], border:`1px solid ${DIFF_COLORS[site.diff]}44`, padding:"3px 10px", borderRadius:10, fontSize:11, fontWeight:700 }}>{site.diff.toUpperCase()}</span>
              {site.wreck && <span style={{ background:"#451a0333", color:"#fb923c", border:"1px solid #92400e44", padding:"3px 10px", borderRadius:10, fontSize:11, fontWeight:700 }}>WRECK</span>}
              {done && <span style={{ background:"#05251533", color:"#4ade80", border:"1px solid #14532d44", padding:"3px 10px", borderRadius:10, fontSize:11, fontWeight:700 }}>‚úì DIVED</span>}
            </div>
            <div style={{ fontSize:11, color:"#475569", marginTop:4 }}>üìç {site.country} ¬∑ {site.region} ¬∑ {site.lat.toFixed(3)}¬∞, {site.lng.toFixed(3)}¬∞ ¬∑ Near {site.town}</div>
          </div>
          <div style={{ display:"flex", gap:7 }}>
            <button className="btn btn-sm" style={{ background:wishl?"#450a0a":"#0a0f1e", color:wishl?"#f87171":"#475569", border:`1px solid ${wishl?"#7f1d1d":"#1e293b"}` }} onClick={() => toggleWishlist(site.id)}>
              {wishl?"‚ô• SAVED":"‚ô° WISHLIST"}
            </button>
            <button className="btn btn-sm" style={{ background:done?"#052e16":"#0a0f1e", color:done?"#4ade80":"#475569", border:`1px solid ${done?"#14532d":"#1e293b"}` }} onClick={() => toggleCompleted(site.id)}>
              {done?"‚úì DIVED":"MARK DIVED"}
            </button>
            <button className="btn btn-sm" style={{ background:inComp?"#0c2346":"#0a0f1e", color:inComp?"#60a5fa":"#475569", border:`1px solid ${inComp?"#1d4ed8":"#1e293b"}` }} onClick={() => addToCompare(site)}>
              COMPARE
            </button>
          </div>
        </div>
        <div style={{ display:"flex", gap:0, marginTop:14 }}>
          {TABS.map(t => <button key={t} className={`nav-tab ${tab===t?"active":""}`} style={{ fontSize:11 }} onClick={() => setTab(t)}>{t.toUpperCase()}</button>)}
        </div>
      </div>

      <div style={{ padding:"24px 28px", maxWidth:980, margin:"0 auto" }}>
        {/* OVERVIEW */}
        {tab === "overview" && (
          <div className="fade-in">
            <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fill,minmax(130px,1fr))", gap:10, marginBottom:20 }}>
              {[["üèä","MAX DEPTH",`${site.maxD}m`],["üìè","AVG DEPTH",`${site.avgD}m`],["üëÅ","VISIBILITY",`${site.vis}m`],["üå°","TEMP",`${site.temp}¬∞C`],["üåä","CURRENT",site.current],["üö§","ENTRY",site.entry],["üìú","CERT",site.cert],["üí∞","BUDGET",site.budget]].map(([ico,l,v]) => (
                <div key={l} style={{ background:"linear-gradient(135deg,#0a0f1e,#060d1a)", border:"1px solid #1e293b", borderRadius:8, padding:"12px 8px", textAlign:"center" }}>
                  <div style={{ fontSize:18, marginBottom:4 }}>{ico}</div>
                  <div className="bebas" style={{ fontSize:17, color:"#38bdf8" }}>{v}</div>
                  <div style={{ fontSize:9, color:"#334155", letterSpacing:"0.07em", marginTop:2 }}>{l}</div>
                </div>
              ))}
            </div>

            <div className="card" style={{ marginBottom:16 }}>
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:12, letterSpacing:"0.08em" }}>ABOUT THIS SITE</div>
              <p style={{ fontSize:13, color:"#94a3b8", lineHeight:1.8 }}>{site.desc}</p>
            </div>

            <div style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:16, marginBottom:16 }}>
              <div className="card">
                <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:12, letterSpacing:"0.08em" }}>COMMUNITY RATING</div>
                <div style={{ display:"flex", alignItems:"center", gap:16 }}>
                  <div style={{ textAlign:"center" }}>
                    <div className="bebas" style={{ fontSize:44, color:"#fbbf24", lineHeight:1 }}>{site.rating}</div>
                    <div style={{ color:"#fbbf24", fontSize:16 }}>{"‚òÖ".repeat(Math.floor(site.rating))}</div>
                    <div style={{ fontSize:10, color:"#475569", marginTop:3 }}>{site.dives.toLocaleString()} dives</div>
                  </div>
                  <div style={{ flex:1 }}>
                    {[["Wildlife",4.7],["Conditions",4.2],["Value",3.9],["Crowding",3.6]].map(([l,v]) => (
                      <div key={l} style={{ marginBottom:7 }}>
                        <div style={{ display:"flex", justifyContent:"space-between", fontSize:10, marginBottom:3 }}>
                          <span style={{ color:"#64748b" }}>{l}</span><span style={{ color:"#94a3b8" }}>{v}</span>
                        </div>
                        <div className="progress-bar"><div className="progress-fill" style={{ width:`${v*20}%` }} /></div>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              <div className="card">
                <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:12, letterSpacing:"0.08em" }}>BEST MONTHS</div>
                <div style={{ display:"flex", flexWrap:"wrap", gap:5 }}>
                  {MONTHS.map((m,i) => {
                    const best = site.months.includes(i+1);
                    const now = new Date().getMonth()===i;
                    return (
                      <div key={m} style={{ padding:"5px 8px", borderRadius:5, fontSize:10, fontWeight:600, background:best?(now?"#0c4a6e":"#0a2a40"):"#060d1a", color:best?(now?"#38bdf8":"#7dd3fc"):"#1e293b", border:`1px solid ${best?(now?"#0ea5e9":"#1e4d7a"):"#0f172a"}` }}>
                        {m}{now&&best&&" ‚Üê"}
                      </div>
                    );
                  })}
                </div>
              </div>
            </div>

            {/* Reviews */}
            <div className="card">
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>RECENT REVIEWS</div>
              {mockReviews.map((r,i) => (
                <div key={i} style={{ marginBottom:14, paddingBottom:14, borderBottom: i<mockReviews.length-1?"1px solid #0f172a":"none" }}>
                  <div style={{ display:"flex", alignItems:"center", gap:10, marginBottom:6 }}>
                    <div style={{ fontSize:12, fontWeight:600, color:"#e2e8f0" }}>{r.who}</div>
                    <div style={{ color:"#fbbf24", fontSize:11 }}>{"‚òÖ".repeat(r.stars)}</div>
                    <div style={{ fontSize:10, color:"#334155", marginLeft:"auto" }}>{r.when}</div>
                  </div>
                  <div style={{ fontSize:12, color:"#94a3b8", lineHeight:1.6 }}>{r.text}</div>
                </div>
              ))}
              {user && (
                <div style={{ marginTop:14, paddingTop:14, borderTop:"1px solid #0f172a" }}>
                  <textarea className="input" rows={3} placeholder="Share your dive experience..." style={{ resize:"none", marginBottom:8 }} />
                  <button className="btn btn-ocean btn-sm">POST REVIEW</button>
                </div>
              )}
            </div>
          </div>
        )}

        {/* CONDITIONS */}
        {tab === "conditions" && (
          <div className="fade-in" style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:16 }}>
            <div className="card">
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>DEPTH PROFILE</div>
              {[["Min Entry",Math.round(site.maxD*0.15)],["Average",site.avgD],["Maximum",site.maxD]].map(([l,v]) => (
                <div key={l} style={{ marginBottom:12 }}>
                  <div style={{ display:"flex", justifyContent:"space-between", fontSize:11, marginBottom:5 }}>
                    <span style={{ color:"#64748b" }}>{l}</span><span style={{ color:"#94a3b8" }}>{v}m</span>
                  </div>
                  <div className="progress-bar"><div className="progress-fill" style={{ width:`${(v/site.maxD)*100}%` }} /></div>
                </div>
              ))}
            </div>

            <div className="card">
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>CONDITIONS AT A GLANCE</div>
              {[["Visibility",`${site.vis}m`,site.vis>25?"Excellent":site.vis>15?"Good":"Moderate"],["Temperature",`${site.temp}¬∞C`,site.temp>26?"Warm":site.temp>18?"Temperate":"Cold"],["Current",site.current.toUpperCase(),""],["Photography",site.photo,""],["Crowding",site.crowd,""],["Budget",site.budget,""]].map(([l,v,n]) => (
                <div key={l} style={{ display:"flex", justifyContent:"space-between", padding:"7px 0", borderBottom:"1px solid #0a0f1e", fontSize:12 }}>
                  <span style={{ color:"#64748b" }}>{l}</span>
                  <span style={{ color:"#e2e8f0" }}>{v}{n&&<span style={{ color:"#475569", marginLeft:5, fontSize:10 }}>({n})</span>}</span>
                </div>
              ))}
            </div>

            <div className="card" style={{ gridColumn:"1/-1" }}>
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>SEASONAL TEMP GUIDE</div>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(12,1fr)", gap:4 }}>
                {MONTHS.map((m,i) => {
                  const v = Math.sin((i/12)*2*Math.PI)*3;
                  const t = Math.round(site.temp + (site.lat>0?v:-v));
                  const best = site.months.includes(i+1);
                  return (
                    <div key={m} style={{ textAlign:"center" }}>
                      <div style={{ fontSize:8, color:best?"#38bdf8":"#1e293b", marginBottom:4 }}>{m}</div>
                      <div style={{ padding:"5px 2px", borderRadius:4, fontSize:10, background:best?"#0c4a6e":"#060d1a", color:best?"#7dd3fc":"#1e293b" }}>{t}¬∞</div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        )}

        {/* WILDLIFE */}
        {tab === "wildlife" && (
          <div className="fade-in">
            <div className="card" style={{ marginBottom:16 }}>
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>MARINE LIFE</div>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fill,minmax(160px,1fr))", gap:10 }}>
                {site.wildlife.map((w,i) => {
                  const freq = i<2?"common":i<4?"occasional":"rare";
                  const fc = {common:"#10b981",occasional:"#f59e0b",rare:"#94a3b8"}[freq];
                  const ico = w.includes("shark")?"ü¶à":w.includes("manta")?"üêü":w.includes("turtle")?"üê¢":w.includes("dolphin")?"üê¨":w.includes("whale")?"üêã":w.includes("nudibranch")?"üêõ":w.includes("seahorse")?"üê¥":w.includes("octopus")?"üêô":"üê†";
                  return (
                    <div key={w} style={{ background:"#060d1a", border:"1px solid #0f172a", borderRadius:7, padding:"10px 12px" }}>
                      <div style={{ fontSize:16, marginBottom:4 }}>{ico}</div>
                      <div style={{ fontSize:12, color:"#e2e8f0" }}>{w}</div>
                      <div style={{ fontSize:10, color:fc, marginTop:2, fontWeight:600 }}>{freq}</div>
                    </div>
                  );
                })}
              </div>
            </div>
            <div className="card">
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:10, letterSpacing:"0.08em" }}>HABITAT NOTES</div>
              <p style={{ fontSize:13, color:"#94a3b8", lineHeight:1.8 }}>
                {site.types.includes("reef") && "Coral reef with diverse hard and soft coral formations. "}
                {site.types.includes("wall") && "Vertical wall extending to significant depth, home to sea fans and sponges. "}
                {site.types.includes("muck") && "Muck dive site on sandy/silty substrate rich with macro critters. "}
                {site.types.includes("wreck") && "Artificial reef formed by wreck, heavily colonized by coral and invertebrates. "}
                {site.types.includes("cave") && "Cave or cavern habitat with unique light conditions and cave-adapted species. "}
                {site.types.includes("cenote") && "Freshwater or brackish sinkhole with exceptional clarity and stalactite formations. "}
                Photography recommended: <strong style={{ color:"#38bdf8" }}>{site.photo}</strong>.
              </p>
            </div>
          </div>
        )}

        {/* LOGISTICS */}
        {tab === "logistics" && (
          <div className="fade-in" style={{ display:"grid", gridTemplateColumns:"1fr 1fr", gap:16 }}>
            <div className="card">
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>HOW TO GET THERE</div>
              {[["Entry Method",site.entry.toUpperCase()],["Nearby Town",site.town],["Region",site.region],["Country",site.country]].map(([l,v]) => (
                <div key={l} style={{ display:"flex", justifyContent:"space-between", padding:"8px 0", borderBottom:"1px solid #0a0f1e", fontSize:12 }}>
                  <span style={{ color:"#64748b" }}>{l}</span><span style={{ color:"#e2e8f0" }}>{v}</span>
                </div>
              ))}
            </div>
            <div className="card">
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>WHAT TO BRING</div>
              {[
                site.maxD > 30 ? "Computer with deep-stop capability" : "Basic dive computer",
                "SMB + reel (mandatory)",
                site.temp < 20 ? "Drysuit or 7mm wetsuit" : site.temp < 25 ? "5mm wetsuit" : "3mm shorty or skin",
                (site.current === "strong" || site.current === "moderate") ? "Reef hook (essential)" : "Reef hook (optional)",
                "Dive torch for overhangs and crevices",
                site.types.includes("macro") || site.types.includes("muck") ? "Macro lens + twin strobes" : "Wide angle lens",
                "Dive knife or shears",
              ].map((item,i) => (
                <div key={i} style={{ fontSize:11, color:"#94a3b8", padding:"5px 0", display:"flex", gap:8 }}>
                  <span style={{ color:"#10b981" }}>‚úì</span>{item}
                </div>
              ))}
            </div>
            <div className="card" style={{ gridColumn:"1/-1" }}>
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>OPERATOR INFO</div>
              <div style={{ display:"grid", gridTemplateColumns:"repeat(3,1fr)", gap:12 }}>
                {[
                  ["Trip Length", site.entry==="liveaboard"?"7-14 days":site.entry==="boat"?"Half/Full day":"Self-guided"],
                  ["Price Range", site.budget==="low"?"$30-80/day":site.budget==="medium"?"$80-200/day":"$200-800/day"],
                  ["Hyperbaric Chamber", `Contact dive operator near ${site.town}`],
                ].map(([l,v]) => (
                  <div key={l} style={{ padding:12, background:"#060d1a", borderRadius:7 }}>
                    <div style={{ fontSize:10, color:"#475569", marginBottom:4, fontWeight:600 }}>{l}</div>
                    <div style={{ fontSize:12, color:"#94a3b8" }}>{v}</div>
                  </div>
                ))}
              </div>
            </div>
          </div>
        )}

        {/* SAFETY */}
        {tab === "safety" && (
          <div className="fade-in">
            <div className="card" style={{ marginBottom:16, borderColor:"#7f1d1d", background:"#0a0505" }}>
              <div style={{ fontSize:12, fontWeight:700, color:"#ef4444", marginBottom:14, letterSpacing:"0.08em" }}>‚ö† HAZARDS & SAFETY</div>
              {[
                site.current !== "none" && `CURRENT: ${site.current.toUpperCase()} current ‚Äî use reef hook, never fight current`,
                site.maxD > 30 && `DEPTH: Maximum ${site.maxD}m ‚Äî mandatory safety stop, narcosis risk`,
                (site.types.includes("cave")||site.types.includes("cenote")) && "OVERHEAD: Cave training required. Never penetrate beyond light zone without certification",
                site.types.includes("drift") && "DRIFT: Deploy SMB on ascent, stay with guide, have contingency plan",
                `Recommended minimum certification: ${site.cert}`,
                "Always dive within your certification and experience level",
                "File dive plan with operator before each dive",
              ].filter(Boolean).map((note,i) => (
                <div key={i} style={{ fontSize:12, color:"#fca5a5", padding:"6px 0", display:"flex", gap:8, borderBottom:"1px solid #1a0a0a" }}>
                  <span style={{ color:"#ef4444" }}>‚ñ∂</span>{note}
                </div>
              ))}
            </div>
            <div className="card">
              <div style={{ fontSize:12, fontWeight:700, color:"#0ea5e9", marginBottom:14, letterSpacing:"0.08em" }}>EMERGENCY CONTACTS</div>
              {[["DAN Emergency","+1-919-684-9111"],["DAN Non-Emergency","+1-919-684-2948"],["Local Chamber",`Contact dive operator near ${site.town}`],["VHF Emergency","Channel 16"]].map(([l,v]) => (
                <div key={l} style={{ display:"flex", justifyContent:"space-between", padding:"8px 0", borderBottom:"1px solid #0a0f1e", fontSize:12 }}>
                  <span style={{ color:"#64748b" }}>{l}</span><span style={{ color:"#e2e8f0" }}>{v}</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

// ============================================================
// COMPARE VIEW
// ============================================================
function CompareView({ compareList, setCompareList, allSites, addToCompare, onOpen }) {
  const [addSearch, setAddSearch] = useState("");
  const suggestions = addSearch.length > 1 ? allSites.filter(s => s.name.toLowerCase().includes(addSearch.toLowerCase()) && !compareList.find(c => c.id===s.id)).slice(0,5) : [];

  if (compareList.length === 0) {
    return (
      <div style={{ display:"flex", alignItems:"center", justifyContent:"center", height:"100%", flexDirection:"column", gap:16 }}>
        <div style={{ fontSize:48 }}>‚öñÔ∏è</div>
        <div className="bebas" style={{ fontSize:28, color:"#334155" }}>COMPARE DIVE SITES</div>
        <div style={{ fontSize:13, color:"#475569" }}>Add up to 3 sites from the map or site list to compare side-by-side</div>
      </div>
    );
  }

  const metrics = [
    {label:"Max Depth",key:"maxD",unit:"m",type:"bar",max:100},
    {label:"Visibility",key:"vis",unit:"m",type:"bar",max:60},
    {label:"Temperature",key:"temp",unit:"¬∞C",type:"bar",max:35},
    {label:"Rating",key:"rating",unit:"",type:"bar",max:5},
    {label:"Difficulty",key:"diff",type:"text"},
    {label:"Cert Required",key:"cert",type:"text"},
    {label:"Entry",key:"entry",type:"text"},
    {label:"Budget",key:"budget",type:"text"},
    {label:"Current",key:"current",type:"text"},
    {label:"Photography",key:"photo",type:"text"},
  ];

  return (
    <div style={{ height:"100%", overflow:"auto", padding:"24px 28px" }}>
      <div style={{ display:"flex", alignItems:"center", gap:16, marginBottom:24 }}>
        <div className="bebas" style={{ fontSize:26 }}>COMPARE SITES</div>
        <div style={{ position:"relative", flex:1, maxWidth:280 }}>
          <input className="input" placeholder="Add another site..." value={addSearch} onChange={e => setAddSearch(e.target.value)} style={{ paddingLeft:28 }} />
          <span style={{ position:"absolute", left:9, top:"50%", transform:"translateY(-50%)", fontSize:11, color:"#475569" }}>+</span>
          {suggestions.length > 0 && (
            <div style={{ position:"absolute", top:"calc(100%+4px)", left:0, width:"100%", background:"#0a1628", border:"1px solid #1e293b", borderRadius:6, zIndex:100, marginTop:2 }}>
              {suggestions.map(s => (
                <div key={s.id} style={{ padding:"8px 12px", cursor:"pointer", fontSize:12 }}
                  onMouseEnter={e => e.currentTarget.style.background="#0f172a"} onMouseLeave={e => e.currentTarget.style.background="transparent"}
                  onClick={() => { addToCompare(s); setAddSearch(""); }}>
                  {s.name} <span style={{ color:"#475569", fontSize:10 }}>‚Äî {s.country}</span>
                </div>
              ))}
            </div>
          )}
        </div>
        <button className="btn btn-ghost btn-sm" onClick={() => setCompareList([])}>CLEAR ALL</button>
      </div>

      {/* Compare table */}
      <div style={{ display:"flex", gap:0 }}>
        {/* Label col */}
        <div style={{ width:140, flexShrink:0 }}>
          <div style={{ height:120 }} />
          {metrics.map(m => (
            <div key={m.label} style={{ height:52, display:"flex", alignItems:"center", paddingLeft:4, borderBottom:"1px solid #0a0f1e" }}>
              <span style={{ fontSize:11, color:"#475569", fontWeight:600 }}>{m.label}</span>
            </div>
          ))}
          <div style={{ height:52, display:"flex", alignItems:"center", paddingLeft:4, borderBottom:"1px solid #0a0f1e" }}>
            <span style={{ fontSize:11, color:"#475569", fontWeight:600 }}>Wildlife</span>
          </div>
          <div style={{ height:80, display:"flex", alignItems:"center", paddingLeft:4 }}>
            <span style={{ fontSize:11, color:"#475569", fontWeight:600 }}>Best Months</span>
          </div>
        </div>

        {/* Site columns */}
        {compareList.map(site => (
          <div key={site.id} style={{ flex:1, minWidth:0, padding:"0 10px", borderLeft:"1px solid #0f172a" }}>
            {/* Site header */}
            <div style={{ height:120, display:"flex", flexDirection:"column", justifyContent:"center", gap:6 }}>
              <div style={{ fontSize:14, fontWeight:700, color:"#f1f5f9", cursor:"pointer" }} onClick={() => onOpen(site)}>{site.name}</div>
              <div style={{ fontSize:11, color:"#475569" }}>{site.country}</div>
              <span style={{ background:DIFF_COLORS[site.diff]+"22", color:DIFF_COLORS[site.diff], padding:"2px 8px", borderRadius:10, fontSize:10, fontWeight:700, display:"inline-block" }}>{site.diff}</span>
              <button className="btn btn-ghost btn-sm" style={{ fontSize:9, padding:"2px 8px" }} onClick={() => setCompareList(p => p.filter(s => s.id !== site.id))}>‚úï REMOVE</button>
            </div>

            {/* Metrics */}
            {metrics.map(m => (
              <div key={m.label} style={{ height:52, display:"flex", alignItems:"center", borderBottom:"1px solid #0a0f1e" }}>
                {m.type === "bar" ? (
                  <div style={{ flex:1 }}>
                    <div style={{ fontSize:13, fontWeight:600, color:"#38bdf8", marginBottom:4 }}>{site[m.key]}{m.unit}</div>
                    <div className="progress-bar" style={{ height:3 }}><div className="progress-fill" style={{ width:`${(site[m.key]/m.max)*100}%` }} /></div>
                  </div>
                ) : (
                  <div style={{ fontSize:12, color:"#94a3b8", textTransform:"capitalize" }}>{site[m.key]}</div>
                )}
              </div>
            ))}

            {/* Wildlife */}
            <div style={{ height:52, display:"flex", alignItems:"center", borderBottom:"1px solid #0a0f1e", flexWrap:"wrap", gap:3, overflow:"hidden" }}>
              {site.wildlife.slice(0,3).map(w => <span key={w} style={{ fontSize:9, color:"#0891b2" }}>üê† {w}</span>)}
            </div>

            {/* Best months */}
            <div style={{ height:80, display:"flex", alignItems:"center", flexWrap:"wrap", gap:3, paddingTop:8 }}>
              {MONTHS.map((m,i) => {
                const best = site.months.includes(i+1);
                return <div key={m} style={{ fontSize:8, padding:"2px 5px", borderRadius:3, background:best?"#0c4a6e":"#060d1a", color:best?"#38bdf8":"#1e293b", border:`1px solid ${best?"#0ea5e9":"#0a0f1e"}` }}>{m}</div>;
              })}
            </div>
          </div>
        ))}

        {/* Empty slots */}
        {compareList.length < 3 && Array.from({length:3-compareList.length}).map((_,i) => (
          <div key={i} style={{ flex:1, minWidth:0, borderLeft:"1px solid #0f172a", display:"flex", alignItems:"center", justifyContent:"center" }}>
            <div style={{ textAlign:"center", color:"#1e293b" }}>
              <div style={{ fontSize:24, marginBottom:8 }}>+</div>
              <div style={{ fontSize:11 }}>Add site</div>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// ============================================================
// PROFILE VIEW
// ============================================================
function ProfileView({ user, setUser, wishlist, completed, allSites, onOpen }) {
  const wishlSites = allSites.filter(s => wishlist.includes(s.id));
  const donesSites = allSites.filter(s => completed.includes(s.id));

  if (!user) {
    return (
      <div style={{ display:"flex", alignItems:"center", justifyContent:"center", height:"100%", flexDirection:"column", gap:16 }}>
        <div style={{ fontSize:48 }}>ü§ø</div>
        <div className="bebas" style={{ fontSize:28, color:"#334155" }}>YOUR DIVE LOGBOOK</div>
        <div style={{ fontSize:13, color:"#475569", marginBottom:8 }}>Sign in to track dives, build wishlists, and get personalized recommendations</div>
        <button className="btn btn-ocean" onClick={() => {}}>SIGN IN TO ACCESS</button>
      </div>
    );
  }

  const currentMonth = new Date().getMonth()+1;
  const recommended = allSites.filter(s => s.months.includes(currentMonth) && !completed.includes(s.id) && !wishlist.includes(s.id)).sort((a,b) => b.rating-a.rating).slice(0,4);

  return (
    <div style={{ height:"100%", overflow:"auto", padding:"24px 28px" }}>
      {/* Profile header */}
      <div className="card" style={{ display:"flex", alignItems:"center", gap:20, marginBottom:20 }}>
        <div style={{ width:64, height:64, borderRadius:"50%", background:"linear-gradient(135deg,#0c4a6e,#0284c7)", border:"3px solid #0ea5e9", display:"flex", alignItems:"center", justifyContent:"center" }}>
          <span className="bebas" style={{ fontSize:28, color:"#fff" }}>{user.name[0].toUpperCase()}</span>
        </div>
        <div style={{ flex:1 }}>
          <div className="bebas" style={{ fontSize:22, color:"#f1f5f9" }}>{user.name.toUpperCase()}</div>
          <div style={{ fontSize:12, color:"#475569" }}>{user.email} ¬∑ {user.cert} Certified</div>
          <div style={{ display:"flex", gap:16, marginTop:6 }}>
            {[["Total Logged Dives",`${user.dives}`],["Wishlisted",wishlist.length],["Completed",completed.length]].map(([l,v]) => (
              <div key={l}>
                <div className="bebas" style={{ fontSize:22, color:"#38bdf8" }}>{v}</div>
                <div style={{ fontSize:9, color:"#475569", fontWeight:600, letterSpacing:"0.07em" }}>{l.toUpperCase()}</div>
              </div>
            ))}
          </div>
        </div>
        <button className="btn btn-ghost btn-sm" onClick={() => setUser(null)}>SIGN OUT</button>
      </div>

      {/* Recommendations */}
      <div style={{ marginBottom:20 }}>
        <div className="bebas" style={{ fontSize:18, marginBottom:14, color:"#94a3b8" }}>RECOMMENDED FOR {MONTHS[new Date().getMonth()].toUpperCase()}</div>
        <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fill,minmax(240px,1fr))", gap:10 }}>
          {recommended.map(site => (
            <div key={site.id} className="card" style={{ cursor:"pointer" }} onClick={() => onOpen(site)}>
              <div style={{ fontSize:13, fontWeight:700, color:"#f1f5f9", marginBottom:4 }}>{site.name}</div>
              <div style={{ fontSize:11, color:"#475569", marginBottom:8 }}>{site.country}</div>
              <div style={{ display:"flex", gap:8 }}>
                <span style={{ fontSize:10, color:"#38bdf8" }}>{site.maxD}m</span>
                <span style={{ fontSize:10, color:"#64748b" }}>¬∑</span>
                <span style={{ fontSize:10, color:DIFF_COLORS[site.diff] }}>{site.diff}</span>
                <span style={{ fontSize:10, color:"#64748b", marginLeft:"auto" }}>‚òÖ {site.rating}</span>
              </div>
            </div>
          ))}
        </div>
      </div>

      {/* Wishlist */}
      <div style={{ marginBottom:20 }}>
        <div className="bebas" style={{ fontSize:18, marginBottom:14, color:"#94a3b8" }}>WISHLIST ({wishlSites.length})</div>
        {wishlSites.length === 0 ? (
          <div className="card" style={{ textAlign:"center", color:"#334155", padding:32 }}>No sites wishlisted yet ‚Äî add some from the map!</div>
        ) : (
          <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fill,minmax(240px,1fr))", gap:10 }}>
            {wishlSites.map(site => (
              <div key={site.id} className="card" style={{ cursor:"pointer" }} onClick={() => onOpen(site)}>
                <div style={{ fontSize:13, fontWeight:700, color:"#f1f5f9", marginBottom:4 }}>‚ô• {site.name}</div>
                <div style={{ fontSize:11, color:"#475569" }}>{site.country} ¬∑ {site.region}</div>
              </div>
            ))}
          </div>
        )}
      </div>

      {/* Completed */}
      <div>
        <div className="bebas" style={{ fontSize:18, marginBottom:14, color:"#94a3b8" }}>DIVED ({donesSites.length})</div>
        {donesSites.length === 0 ? (
          <div className="card" style={{ textAlign:"center", color:"#334155", padding:32 }}>No dives logged yet ‚Äî mark sites as dived!</div>
        ) : (
          <div style={{ display:"grid", gridTemplateColumns:"repeat(auto-fill,minmax(240px,1fr))", gap:10 }}>
            {donesSites.map(site => (
              <div key={site.id} className="card" style={{ cursor:"pointer" }} onClick={() => onOpen(site)}>
                <div style={{ fontSize:13, fontWeight:700, color:"#f1f5f9", marginBottom:4 }}>‚úì {site.name}</div>
                <div style={{ fontSize:11, color:"#475569" }}>{site.country} ¬∑ {site.region}</div>
                <div style={{ fontSize:10, color:"#10b981", marginTop:4 }}>Max depth: {site.maxD}m</div>
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}


    // Mount the app
    ReactDOM.createRoot(document.getElementById("root")).render(<DiveAtlas />);
  </script>
</body>
</html>
